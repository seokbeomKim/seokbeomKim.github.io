<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Stack Protectorì™€ ë””ë²„ê¹… ì´ì•¼ê¸° | ë²”&#39;s blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="Stack Protector, ë„Œ ë­í•˜ëŠ” ë†ˆì´ëƒ? ğŸ”—í˜„ì—…ì—ì„œ ì»¤ë„ì˜ CONFIG_STACK_PROTECTOR ë¥¼ í™œì„±í™”í•˜ë©´ ì»¤ë„ ë¶€íŠ¸ê°€ ì•ˆëœë‹¤ëŠ” ì´ìŠˆê°€ ë³´ê³ ë˜ì—ˆë‹¤. Trace32 ë¡œ callstackì„ ì‚´í´ë³´ë‹ˆ ë‚´ íŒŒíŠ¸ì—ì„œ ë§¡ê³  ìˆëŠ” ë””ë°”">
<meta name="generator" content="Hugo 0.92.2" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-Y7VW74D2P3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
	  <a class="button" href="https://seokbeomkim.github.io/index.xml">Subscribe</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Stack Protectorì™€ ë””ë²„ê¹… ì´ì•¼ê¸°</h1>

    <div class="tip">
        <time datetime="2022-02-03 15:00:45 &#43;0900 KST">Feb 3, 2022</time>
        <span class="split">
          Â·
        </span>
        <span>
          2314 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          5 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#stack-protector-ë„Œ-ë­í•˜ëŠ”-ë†ˆì´ëƒ">Stack Protector, ë„Œ ë­í•˜ëŠ” ë†ˆì´ëƒ?</a></li>
    <li><a href="#ìŠ¤íƒ-ë ˆì´ì•„ì›ƒ-ì‚´í´ë³´ê¸°">ìŠ¤íƒ ë ˆì´ì•„ì›ƒ ì‚´í´ë³´ê¸°</a>
      <ul>
        <li><a href="#ë¹„í™œì„±í™”-ì‹œì˜-ë ˆì´ì•„ì›ƒ">ë¹„í™œì„±í™” ì‹œì˜ ë ˆì´ì•„ì›ƒ</a></li>
        <li><a href="#í™œì„±í™”-ì‹œì˜-ë ˆì´ì•„ì›ƒ">í™œì„±í™” ì‹œì˜ ë ˆì´ì•„ì›ƒ</a></li>
      </ul>
    </li>
    <li><a href="#stack-smashing-ì—ëŸ¬ê°€-ì•ˆë‚œë‹¤-canary-boundary">Stack Smashing ì—ëŸ¬ê°€ ì•ˆë‚œë‹¤? Canary Boundary</a></li>
    <li><a href="#ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</a></li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h2 id="stack-protector-ë„Œ-ë­í•˜ëŠ”-ë†ˆì´ëƒ">Stack Protector, ë„Œ ë­í•˜ëŠ” ë†ˆì´ëƒ? <a href="#stack-protector-%eb%84%8c-%eb%ad%90%ed%95%98%eb%8a%94-%eb%86%88%ec%9d%b4%eb%83%90" class="anchor">ğŸ”—</a></h2><p>í˜„ì—…ì—ì„œ ì»¤ë„ì˜ <code>CONFIG_STACK_PROTECTOR</code> ë¥¼ í™œì„±í™”í•˜ë©´ ì»¤ë„ ë¶€íŠ¸ê°€ ì•ˆëœë‹¤ëŠ” ì´ìŠˆê°€
ë³´ê³ ë˜ì—ˆë‹¤. Trace32 ë¡œ callstackì„ ì‚´í´ë³´ë‹ˆ ë‚´ íŒŒíŠ¸ì—ì„œ ë§¡ê³  ìˆëŠ” ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ì½”ë“œ ë•Œë¬¸ì—
Stack Overflowê°€ ë°œìƒí•˜ì—¬ ë¶€íŠ¸ê°€ ì•ˆë˜ê³  ìˆì—ˆë‹¤. ë¬¸ì œì˜ ì§€ì ì€ ì‚¬ìˆ˜ê°€ ë°œê²¬í•˜ê³  íŒŒíŠ¸ì¥ì˜ ìˆ˜ì •ìœ¼ë¡œ ë§ˆë¬´ë¦¬ë˜ì—ˆë‹¤.</p>
<p>í•˜ì§€ë§Œ ì´ìŠˆê°€ ë§ˆë¬´ë¦¬ ë˜ê³  Stack Protector ê°€ ì–´ë–¤ ì›ë¦¬ë¡œ ë™ì‘í•˜ëŠ”ì§€ ê¶ê¸ˆí–ˆê³  ì„¤ ì—°íœ´ë¥¼
ë§ì•„ ìì„¸í•˜ê²Œ ì •ë¦¬í•  ìˆ˜ ìˆì—ˆë‹¤. ê·¸ ê³¼ì •ì—ì„œ ìš°ë¶„íˆ¬ì— ì˜ëª»ëœ ë²„ê·¸ ë¦¬í¬íŠ¸ í‹°ì¼“ì„
ë§Œë“¤ì–´ë‚´ê¸´ í–ˆì§€ë§Œ ë§ì´ë‹¤.</p>
<p>Stack Protectionì€ GCCì˜ <code>-fstack-protector, -fstack-protector-all, -fstack-protector-strong</code>
ì˜µì…˜ì„ í†µí•´ í™œì„±í™”í•  ìˆ˜ ìˆê³  <code>-fno-stack-protector</code> ì˜µì…˜ìœ¼ë¡œ ë¹„í™œì„±í™” í•  ìˆ˜ ìˆë‹¤.</p>
<h2 id="ìŠ¤íƒ-ë ˆì´ì•„ì›ƒ-ì‚´í´ë³´ê¸°">ìŠ¤íƒ ë ˆì´ì•„ì›ƒ ì‚´í´ë³´ê¸° <a href="#%ec%8a%a4%ed%83%9d-%eb%a0%88%ec%9d%b4%ec%95%84%ec%9b%83-%ec%82%b4%ed%8e%b4%eb%b3%b4%ea%b8%b0" class="anchor">ğŸ”—</a></h2><h3 id="ë¹„í™œì„±í™”-ì‹œì˜-ë ˆì´ì•„ì›ƒ">ë¹„í™œì„±í™” ì‹œì˜ ë ˆì´ì•„ì›ƒ <a href="#%eb%b9%84%ed%99%9c%ec%84%b1%ed%99%94-%ec%8b%9c%ec%9d%98-%eb%a0%88%ec%9d%b4%ec%95%84%ec%9b%83" class="anchor">ğŸ”—</a></h3><p>ë¨¼ì €, Stack Protectorë¥¼ ë¹„í™œì„±í™”/í™œì„±í™” ë˜ì—ˆì„ ë•Œì˜ ê°ê° ì½œìŠ¤íƒì´ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ì‚´í´ë³´ì.</p>
<p>ë¨¼ì €, ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•œ ì½”ë“œë¥¼ ì¤€ë¹„í•˜ì˜€ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">mul</span>(<span style="color:#0b0;font-weight:bold">int</span> a)
{
        a <span style="color:#666">=</span> a <span style="color:#666">*</span> <span style="color:#666">2</span>;
}

<span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">add</span>(<span style="color:#0b0;font-weight:bold">int</span> a, <span style="color:#0b0;font-weight:bold">int</span> b, <span style="color:#0b0;font-weight:bold">int</span> c, <span style="color:#0b0;font-weight:bold">int</span> d)
{
        <span style="color:#0b0;font-weight:bold">int</span> j <span style="color:#666">=</span> a <span style="color:#666">+</span> <span style="color:#666">1</span>;
        <span style="color:#0b0;font-weight:bold">int</span> e <span style="color:#666">=</span> b <span style="color:#666">+</span> <span style="color:#666">2</span>;
        <span style="color:#0b0;font-weight:bold">int</span> f <span style="color:#666">=</span> c <span style="color:#666">+</span> <span style="color:#666">3</span>;
        <span style="color:#0b0;font-weight:bold">int</span> g <span style="color:#666">=</span> d <span style="color:#666">+</span> <span style="color:#666">4</span>;
        mul(j <span style="color:#666">+</span> e <span style="color:#666">+</span> f <span style="color:#666">+</span> g);
}

<span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">main</span>()
{
        <span style="color:#0b0;font-weight:bold">int</span> a <span style="color:#666">=</span> <span style="color:#666">0</span>;
        <span style="color:#0b0;font-weight:bold">int</span> b <span style="color:#666">=</span> <span style="color:#666">1</span>;
        <span style="color:#0b0;font-weight:bold">int</span> c <span style="color:#666">=</span> <span style="color:#666">2</span>;
        <span style="color:#0b0;font-weight:bold">int</span> d <span style="color:#666">=</span> <span style="color:#666">3</span>;
        add(a, b, c, d);

        <span style="color:#a2f;font-weight:bold">return</span> a;
}
</code></pre></div><p>í˜¸ì¶œ ì „/í›„ë¡œ ARM64 ì•„í‚¤í…ì²˜ì—ì„œì˜ Calling Conventionì„ í™•ì¸í•˜ê¸° í¸í•˜ë„ë¡ ìµœëŒ€í•œ ì½”ë“œë¥¼
í• ë‹¹ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ë‹¤. ìœ„ ì½”ë“œë¥¼ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ ì»´íŒŒì¼í•œ í›„ ë‹¤ì‹œ ì–´ì…ˆë¸”ë¦¬ë¡œ ë°”ê¿”ì£¼ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ aarch64-linux-gnu-gcc callstack.c     <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>        -fno-stack-protector            <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>        -fno-asynchronous-unwind-tables <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>        -fno-exceptions                 <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>        -fno-rtti -fverbose-asm         <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>        -o callstack.o

$ aarch64-linux-gnu-objdump -dS callstack.o &gt; callstack.disassemble
</code></pre></div><p>ìœ„ì™€ ê°™ì´ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ì„ ë§Œë“¤ì—ˆë‹¤ê°€ ë‹¤ì‹œ dump í•˜ëŠ” ì´ìœ ëŠ” ë¶ˆí•„ìš”í•œ ì–´ì…ˆë¸”ë¦¬ ë ˆì´ë¸”ì„
ì—†ì• ê¸° ìœ„í•´ì„œë‹¤. ì‹¤ì œë¡œ gccì˜ -S ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë‹¨ìˆœí•˜ê²Œ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ ë§Œë“¤ì–´ë‚´ë©´ ì›í•˜ëŠ”
ì–´ì…ˆ ì½”ë“œë¥¼ ì–»ê¸° í˜ë“¤ë‹¤. ì´ì œ ì–»ì–´ë‚¸ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ ì‚´í´ë³´ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">0000000000000714 &lt;mul&gt;:
 714:	d10043ff 	sub	sp, sp, #0x10
 718:	b9000fe0 	str	w0, [sp, #12]
 71c:	b9400fe0 	ldr	w0, [sp, #12]
 720:	531f7800 	lsl	w0, w0, #1
 724:	b9000fe0 	str	w0, [sp, #12]
 728:	d503201f 	nop
 72c:	910043ff 	add	sp, sp, #0x10
 730:	d65f03c0 	ret

0000000000000734 &lt;add&gt;:
 734:	a9bd7bfd 	stp	x29, x30, [sp, #-48]!
 738:	910003fd 	mov	x29, sp
 73c:	b9001fe0 	str	w0, [sp, #28]
 740:	b9001be1 	str	w1, [sp, #24]
 744:	b90017e2 	str	w2, [sp, #20]
 748:	b90013e3 	str	w3, [sp, #16]
 74c:	b9401fe0 	ldr	w0, [sp, #28]
 750:	11000400 	add	w0, w0, #0x1
 754:	b9002fe0 	str	w0, [sp, #44]
 758:	b9401be0 	ldr	w0, [sp, #24]
 75c:	11000800 	add	w0, w0, #0x2
 760:	b9002be0 	str	w0, [sp, #40]
 764:	b94017e0 	ldr	w0, [sp, #20]
 768:	11000c00 	add	w0, w0, #0x3
 76c:	b90027e0 	str	w0, [sp, #36]
 770:	b94013e0 	ldr	w0, [sp, #16]
 774:	11001000 	add	w0, w0, #0x4
 778:	b90023e0 	str	w0, [sp, #32]
 77c:	b9402fe1 	ldr	w1, [sp, #44]
 780:	b9402be0 	ldr	w0, [sp, #40]
 784:	0b000021 	add	w1, w1, w0
 788:	b94027e0 	ldr	w0, [sp, #36]
 78c:	0b000021 	add	w1, w1, w0
 790:	b94023e0 	ldr	w0, [sp, #32]
 794:	0b000020 	add	w0, w1, w0
 798:	97ffffdf 	bl	714 &lt;mul&gt;
 79c:	d503201f 	nop
 7a0:	a8c37bfd 	ldp	x29, x30, [sp], #48
 7a4:	d65f03c0 	ret

00000000000007a8 &lt;main&gt;:
 7a8:	a9be7bfd 	stp	x29, x30, [sp, #-32]!
 7ac:	910003fd 	mov	x29, sp
 7b0:	b9001fff 	str	wzr, [sp, #28]
 7b4:	52800020 	mov	w0, #0x1                   	// #1
 7b8:	b9001be0 	str	w0, [sp, #24]
 7bc:	52800040 	mov	w0, #0x2                   	// #2
 7c0:	b90017e0 	str	w0, [sp, #20]
 7c4:	52800060 	mov	w0, #0x3                   	// #3
 7c8:	b90013e0 	str	w0, [sp, #16]
 7cc:	b94013e3 	ldr	w3, [sp, #16]
 7d0:	b94017e2 	ldr	w2, [sp, #20]
 7d4:	b9401be1 	ldr	w1, [sp, #24]
 7d8:	b9401fe0 	ldr	w0, [sp, #28]
 7dc:	97ffffd6 	bl	734 &lt;add&gt;
 7e0:	b9401fe0 	ldr	w0, [sp, #28]
 7e4:	a8c27bfd 	ldp	x29, x30, [sp], #32
 7e8:	d65f03c0 	ret
</code></pre></div><p>ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ main, add, mul í•¨ìˆ˜ê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ ì²«ë²ˆì§¸ ë¼ì¸ì—ì„œ x29/x30 ê°’ì„
sp (ìŠ¤íƒ í¬ì¸í„°)ì— ì €ì¥í•˜ê³  Stack Frameì„ í™•ë³´í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. x29ëŠ” Frame Pointer,
x30ì€ Link Registerë¡œì„œ ì‚¬ìš©ë˜ë©° ê°ê° ìŠ¤íƒ í”„ë ˆì„ì˜ base, Return Addressë¥¼ ê°–ê³  ìˆë‹¤ê³ 
ìƒê°í•˜ë©´ ëœë‹¤. add í•¨ìˆ˜ê°€ mul í•¨ìˆ˜ì—ì„œ ê°ê° stack frameì„ í™•ë³´í•˜ëŠ” ì–´ì…ˆë¸”ë¦¬ ëª…ë ¹ì–´ê°€
ë‹¤ë¥´ê²Œ ë‚˜ì™€ìˆë‹¤. add í•¨ìˆ˜ë¥¼ ë¨¼ì € ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">stp     x29, x30, [sp, #-48]!
</code></pre></div><p>ì´ëŠ” x29, x30 ê°’ì„ [sp]ì— ì €ì¥(spê°€ ê°–ê³  ìˆëŠ” ë©”ëª¨ë¦¬ ì£¼ì†Œì—)í•œ ë‹¤ìŒ spë¥¼ -48 ì˜¤í”„ì…‹ë§Œí¼
ì´ë™í•˜ë¼ëŠ” ëœ»ì´ë‹¤. ì´ ë•Œ, ìŠ¤íƒ í• ë‹¹ì€ ë©”ëª¨ë¦¬ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ í™•ë³´ë˜ëŠ” ì ì— ì£¼ëª©í•˜ì. mul í•¨ìˆ˜ëŠ”
ë³„ë„ì˜ ë°±ì—… ì—†ì´ ê³§ë°”ë¡œ ìŠ¤íƒ í”„ë ˆì„ì„ í™•ë³´í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>
<p>ê³„ì†í•´ì„œ add í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ë©´ ìŠ¤íƒ í”„ë ˆì„ì„ í™•ë³´í•œ í›„ int d, e, fì— í•´ë‹¹í•˜ëŠ” ì§€ì—­ ë³€ìˆ˜ë“¤ì„
ìŠ¤íƒì— ì €ì¥í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. x29ëŠ” stack frame pointer, x30ì€ return addressë¥¼
ì €ì¥í•˜ê³  ìˆë‹¤.</p>
<p><p class="markdown-image">
  <img src="/img/stack-protector_figure_1.png" alt="Stack Layout without Stack Protector"  />
</p></p>
<h3 id="í™œì„±í™”-ì‹œì˜-ë ˆì´ì•„ì›ƒ">í™œì„±í™” ì‹œì˜ ë ˆì´ì•„ì›ƒ <a href="#%ed%99%9c%ec%84%b1%ed%99%94-%ec%8b%9c%ec%9d%98-%eb%a0%88%ec%9d%b4%ec%95%84%ec%9b%83" class="anchor">ğŸ”—</a></h3><p>ê·¸ë ‡ë‹¤ë©´ stack protectorê°€ í™œì„±í™”ëœ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì€ ì–´ë–»ê²Œ ë ê¹Œ? ì´ë²ˆì—ëŠ”
-fstack-protector-all ì˜µì…˜ì„ ì´ìš©í•˜ì—¬ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¥¼ ìƒì„±í•´ì£¼ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">000000000000086c &lt;add&gt;:
 86c:	a9bc7bfd 	stp	x29, x30, [sp, #-64]!
 870:	910003fd 	mov	x29, sp
 874:	b9001fe0 	str	w0, [sp, #28]
 878:	b9001be1 	str	w1, [sp, #24]
 87c:	b90017e2 	str	w2, [sp, #20]
 880:	b90013e3 	str	w3, [sp, #16]
 884:	90000080 	adrp	x0, 10000 &lt;__FRAME_END__+0xf520&gt;
 888:	f947f400 	ldr	x0, [x0, #4072]
 88c:	f9400001 	ldr	x1, [x0]
 890:	f9001fe1 	str	x1, [sp, #56]
 894:	d2800001 	mov	x1, #0x0                   	// #0
 898:	b9401fe0 	ldr	w0, [sp, #28]
 89c:	11000400 	add	w0, w0, #0x1
 8a0:	b9002be0 	str	w0, [sp, #40]
 8a4:	b9401be0 	ldr	w0, [sp, #24]
 8a8:	11000800 	add	w0, w0, #0x2
 8ac:	b9002fe0 	str	w0, [sp, #44]
 8b0:	b94017e0 	ldr	w0, [sp, #20]
 8b4:	11000c00 	add	w0, w0, #0x3
 8b8:	b90033e0 	str	w0, [sp, #48]
 8bc:	b94013e0 	ldr	w0, [sp, #16]
 8c0:	11001000 	add	w0, w0, #0x4
 8c4:	b90037e0 	str	w0, [sp, #52]
 8c8:	b9402be1 	ldr	w1, [sp, #40]
 8cc:	b9402fe0 	ldr	w0, [sp, #44]
 8d0:	0b000021 	add	w1, w1, w0
 8d4:	b94033e0 	ldr	w0, [sp, #48]
 8d8:	0b000021 	add	w1, w1, w0
 8dc:	b94037e0 	ldr	w0, [sp, #52]
 8e0:	0b000020 	add	w0, w1, w0
 8e4:	97ffffcc 	bl	814 &lt;mul&gt;
 8e8:	d503201f 	nop
 8ec:	90000080 	adrp	x0, 10000 &lt;__FRAME_END__+0xf520&gt;
 8f0:	f947f400 	ldr	x0, [x0, #4072]
 8f4:	f9401fe2 	ldr	x2, [sp, #56]
 8f8:	f9400001 	ldr	x1, [x0]
 8fc:	eb010042 	subs	x2, x2, x1
 900:	d2800001 	mov	x1, #0x0                   	// #0
 904:	54000040 	b.eq	90c &lt;add+0xa0&gt;  // b.none
 908:	97ffff66 	bl	6a0 &lt;__stack_chk_fail@plt&gt;
 90c:	a8c47bfd 	ldp	x29, x30, [sp], #64
 910:	d65f03c0 	ret
</code></pre></div><p>ë³´ê¸°ì—ë„ ì´ì „ì— ì‚´í´ë´¤ë˜ add í•¨ìˆ˜ë³´ë‹¤ í›¨ì”¬ ì½”ë“œê°€ ê¸¸ì–´ì¡Œë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê±´ í•¨ìˆ˜ ì´ˆê¸°ì—
ìŠ¤íƒ í¬ì¸í„°ë¥¼ ì›€ì§ì¸ í›„ canary ì˜ì—­ì„ ìŠ¤íƒì— ì €ì¥í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"> 884:	90000080 	adrp	x0, 10000 &lt;__FRAME_END__+0xf520&gt;
 888:	f947f400 	ldr	x0, [x0, #4072]
 88c:	f9400001 	ldr	x1, [x0]
 890:	f9001fe1 	str	x1, [sp, #56]
 ...
 908:	97ffff66 	bl	6a0 &lt;__stack_chk_fail@plt&gt;
</code></pre></div><p><p class="markdown-image">
  <img src="/img/stack-protector_figure_2.png" alt="Stack Layout without Stack Protector"  />
</p></p>
<p>Stack Frame Pointerì™€ Link Register ì •ë³´ë¥¼ ìŠ¤íƒ í•˜ìœ„ì— ë‘ê³  ì¼ë°˜ì ìœ¼ë¡œëŠ” ê³§ë°”ë¡œ
ì§€ì—­ë³€ìˆ˜ë“¤ì´ ìœ„ì¹˜í•˜ì§€ë§Œ Stack Protector ë¥¼ í™œì„±í™”í•˜ë©´ ì´ ì˜ì—­ì´ canary ì˜ì—­ìœ¼ë¡œ ì±„ì›Œì§€ëŠ”
ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>
<h2 id="stack-smashing-ì—ëŸ¬ê°€-ì•ˆë‚œë‹¤-canary-boundary">Stack Smashing ì—ëŸ¬ê°€ ì•ˆë‚œë‹¤? Canary Boundary <a href="#stack-smashing-%ec%97%90%eb%9f%ac%ea%b0%80-%ec%95%88%eb%82%9c%eb%8b%a4-canary-boundary" class="anchor">ğŸ”—</a></h2><p>ARM Reference ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ì˜ˆì œ
(<a href="https://developer.arm.com/documentation/101754/0616/armclang-Reference/armclang-Command-line-Options/-fstack-protector---fstack-protector-all---fstack-protector-strong---fno-stack-protector" target="_blank" rel="noopener">https://developer.arm.com/documentation/101754/0616/armclang-Reference/armclang-Command-line-Options/-fstack-protector---fstack-protector-all---fstack-protector-strong---fno-stack-protector</a>)
ë¡œ ì§ì ‘ í™•ì¸í•´ë³´ë ¤ í–ˆì§€ë§Œ ì˜ë„ëœëŒ€ë¡œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤. ì´ì— ì§ì ‘ GDB ë¥¼ ì´ìš©í•˜ì—¬ ë””ë²„ê¹…ì„
í•´ë³´ë‹ˆ ì•„ë˜ì™€ ê°™ì´ fs:0x28, ì¦‰ canary valueì˜ í•˜ìœ„ 8ë¹„íŠ¸ê°€ 0ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì–´ ìˆì—ˆë‹¤.</p>
<p><p class="markdown-image">
  <img src="/img/stack-protector_figure_3.png" alt="Stack Layout without Stack Protector"  />
</p></p>
<p>fs, gs ë ˆì§€ìŠ¤í„°ëŠ” íŠ¹ë³„í•œ ìš´ì˜ì²´ì œì˜ ìë£Œêµ¬ì¡°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤. íŠ¹íˆ, FS:0x28ì€
ë¦¬ëˆ…ìŠ¤ì—ì„œ stack-guard ê°’ì„ ì €ì¥í•˜ê³  stack-guard check ë£¨í‹´ì—ì„œ ì‚¬ìš©ëœë‹¤.
(<a href="https://stackoverflow.com/questions/10325713/why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value" target="_blank" rel="noopener">https://stackoverflow.com/questions/10325713/why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value</a>)
ê·¸ëŸ°ë° fs:0x28 ê°’ì´ ì²˜ìŒë¶€í„° í•˜ìœ„ 1ë°”ì´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì€ ì»¤ë„ ìª½ ì½”ë“œì— ì˜í•œ ê²ƒì´ë¼ê³ 
ìƒê°í•˜ê³  ì‚´í´ë³´ë‹ˆ, ì»¤ë„ include/linux/random.h íŒŒì¼ì— ì•„ë˜ì˜ ì½”ë“œê°€ ìˆì—ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#080;font-style:italic">/*
</span><span style="color:#080;font-style:italic"> * On 64-bit architectures, protect against non-terminated C string overflows
</span><span style="color:#080;font-style:italic"> * by zeroing out the first byte of the canary; this leaves 56 bits of entropy.
</span><span style="color:#080;font-style:italic"> */</span>
<span style="color:#080">#ifdef CONFIG_64BIT
</span><span style="color:#080"># ifdef __LITTLE_ENDIAN
</span><span style="color:#080">#  define CANARY_MASK 0xffffffffffffff00UL
</span><span style="color:#080"># else </span><span style="color:#080;font-style:italic">/* big endian, 64 bits: */</span><span style="color:#080">
</span><span style="color:#080">#  define CANARY_MASK 0x00ffffffffffffffUL
</span><span style="color:#080"># endif
</span><span style="color:#080">#else </span><span style="color:#080;font-style:italic">/* 32 bits: */</span><span style="color:#080">
</span><span style="color:#080"># define CANARY_MASK 0xffffffffUL
</span><span style="color:#080">#endif
</span><span style="color:#080"></span>
<span style="color:#a2f;font-weight:bold">static</span> <span style="color:#a2f;font-weight:bold">inline</span> <span style="color:#0b0;font-weight:bold">unsigned</span> <span style="color:#0b0;font-weight:bold">long</span> <span style="color:#00a000">get_random_canary</span>(<span style="color:#0b0;font-weight:bold">void</span>)
{
	<span style="color:#0b0;font-weight:bold">unsigned</span> <span style="color:#0b0;font-weight:bold">long</span> val <span style="color:#666">=</span> get_random_long();

	<span style="color:#a2f;font-weight:bold">return</span> val <span style="color:#666">&amp;</span> CANARY_MASK;
}
</code></pre></div><p>ì²˜ìŒì—ëŠ” êµ³ì´ ì´ë ‡ê²Œ NULLì„ ì²˜ë¦¬í•´ì•¼ í•˜ë‚˜ ì‹¶ì—ˆëŠ”ë° ë¸”ë¼ì¸ë“œë¥¼ í†µí•´ ì•Œê²Œëœ ì‚¬ì‹¤ì€ canary
valueë¥¼ ë°”ë¡œ ì¶œë ¥í•˜ì§€ ëª»í•˜ë„ë¡ NULL ë¬¸ìë¥¼ ì´ìš©í•´ boundaryë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ìš©ë„ë¼ëŠ” ê²ƒì„
ì•Œê²Œëë‹¤. ì´ë¡œì¨ stack protectorê°€ ìŠ¤íƒì—ì„œ ì–´ë–»ê²Œ ìœ„ì¹˜í•˜ëŠ”ì§€, ê·¸ë¦¬ê³  ì™œ ARM ë ˆí¼ëŸ°ìŠ¤ ë¬¸ì„œì—
ìˆëŠ” ì˜ˆì œê°€ ë™ì‘ì„ í•˜ì§€ ì•ŠëŠ”ì§€, canary boundary ê°’ì´ ì™œ NULLë¡œ ë˜ì–´ìˆëŠ”ì§€ ë“±ì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.</p>
<h2 id="ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ <a href="#%ec%b0%b8%ea%b3%a0-%ec%9e%90%eb%a3%8c" class="anchor">ğŸ”—</a></h2><ul>
<li><a href="https://stackoverflow.com/questions/10325713/why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value" target="_blank" rel="noopener">FS/GS ë ˆì§€ìŠ¤í„° in Stackoverflow</a></li>
<li><a href="https://wolchok.org/posts/how-to-read-arm64-assembly-language/" target="_blank" rel="noopener">stp ë ˆì§€ìŠ¤í„° ì‚¬ìš© ì˜ˆ</a></li>
<li><a href="https://www.cs.princeton.edu/courses/archive/spr19/cos217/lectures/15_AssemblyFunctions.pdf" target="_blank" rel="noopener">ARM ì–´ì…ˆë¸”ë¦¬ ê°•ì¢Œ ìë£Œ - Function Calls</a></li>
<li><a href="https://thinkingeek.com/2017/05/29/exploring-aarch64-assembler-chapter-8/" target="_blank" rel="noopener">ARM64 ìŠ¤íƒ ë¶„ì„ ìë£Œ</a></li>
<li><a href="https://stackoverflow.com/questions/38552116/how-to-remove-noise-from-gcc-clang-assembly-output" target="_blank" rel="noopener">GCC ì–´ì…ˆë¸”ë¦¬ strip ë°©ë²• #1</a></li>
<li><a href="https://stackoverflow.com/questions/2529185/what-are-cfi-directives-in-gnu-assembler-gas-used-for" target="_blank" rel="noopener">GCC ì–´ì…ˆë¸”ë¦¬ strip ë°©ë²• #2</a></li>
</ul>

    </div>

    
        <div class="tags">
            
                <a href="https://seokbeomkim.github.io/tags/ssp">ssp</a>
            
                <a href="https://seokbeomkim.github.io/tags/stack">stack</a>
            
                <a href="https://seokbeomkim.github.io/tags/canary">canary</a>
            
        </div>
    
    
    
  <div id="comment">
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kimsukbeom" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>


</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://seokbeomkim.github.io" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>


</div>

    

    <div class="copyright">
    
       Â© Copyright 
       2023 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       Sukbeom Kim
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-mini'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>
