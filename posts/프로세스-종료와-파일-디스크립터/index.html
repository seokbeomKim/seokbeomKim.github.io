<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œì™€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° | Sukbeom Kim</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="íŒŒì¼ì„ open í–ˆëŠ”ë° closeë¥¼ ì•ˆí•˜ë©´? ğŸ”—stdin(0), stdout(2), stderr(3) ì´ë¼ëŠ” ì •í•´ì§„ ê³µì‹ê³¼ í•¨ê»˜ ë¦¬ë‹¤ì´ë ‰ì…˜ê³¼ íŒŒì´í”„ì˜ ê°œë…ë§Œìœ¼ë¡œë„ í¥ë¶„í•˜ë˜ ëŒ€í•™êµ ì‹œì ˆì— ë‚´ê°€ ì•Œë˜">
<meta name="generator" content="Hugo 0.121.2">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">


  
    
    <link rel="stylesheet" href="https://seokbeomkim.github.iocss/img.css">
  

  
    
    <link rel="stylesheet" href="https://seokbeomkim.github.iocss/noto_sans_kr.css">
  

  
    
    <link rel="stylesheet" href="https://seokbeomkim.github.iocss/nanumgothic.css">
  


<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-Y7VW74D2P3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
	  <a class="button" href="https://seokbeomkim.github.io/index.xml">Subscribe</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œì™€ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°</h1>

    <div class="tip">
        <time datetime="2022-05-10 00:03:20 &#43;0900 KST">May 10, 2022</time>
        <span class="split">
          Â·
        </span>
        <span>
          1141 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          3 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#íŒŒì¼ì„-open-í–ˆëŠ”ë°-closeë¥¼-ì•ˆí•˜ë©´">íŒŒì¼ì„ open í–ˆëŠ”ë° closeë¥¼ ì•ˆí•˜ë©´?</a></li>
    <li><a href="#strace-ë¡œ-ì‚½ì§ˆ-í¬ì¸íŠ¸-ì°¾ê¸°">strace ë¡œ ì‚½ì§ˆ í¬ì¸íŠ¸ ì°¾ê¸°</a></li>
    <li><a href="#do_exit---exit_files">do_exit -&gt; exit_files</a></li>
    <li><a href="#ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</a></li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h2 id="íŒŒì¼ì„-open-í–ˆëŠ”ë°-closeë¥¼-ì•ˆí•˜ë©´">íŒŒì¼ì„ open í–ˆëŠ”ë° closeë¥¼ ì•ˆí•˜ë©´? <a href="#%ed%8c%8c%ec%9d%bc%ec%9d%84-open-%ed%96%88%eb%8a%94%eb%8d%b0-close%eb%a5%bc-%ec%95%88%ed%95%98%eb%a9%b4" class="anchor">ğŸ”—</a></h2><p>stdin(0), stdout(2), stderr(3) ì´ë¼ëŠ” ì •í•´ì§„ ê³µì‹ê³¼ í•¨ê»˜ ë¦¬ë‹¤ì´ë ‰ì…˜ê³¼ íŒŒì´í”„ì˜ ê°œë…ë§Œìœ¼ë¡œë„ í¥ë¶„í•˜ë˜ ëŒ€í•™êµ ì‹œì ˆì— ë‚´ê°€ ì•Œë˜ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì˜ ì •ì˜ëŠ” <em>íƒœìŠ¤í¬ê°€ íŒŒì¼ì„ ì—´ë©´ ì–»ê²Œ ë˜ëŠ” ê³ ìœ  idê°’</em> ì´ì—ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ¬í•œ íŒŒì¼ë””ìŠ¤í¬ë¦½í„°ëŠ” í•­ìƒ open ì„ í•´ì£¼ë©´ close ë¥¼ í•´ì¤˜ì•¼ í•œë‹¤ê³  ë°°ì› ë‹¤. ê·¸ëŸ°ë° ë§‰ìƒ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ íŒŒì¼ì„ open í•œ ë’¤ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì „ closeë¥¼ ëª…ì‹œì ìœ¼ë¡œ í•˜ì§€ ì•Šì•„ë„ ì´ë¡œ ì¸í•œ ì˜¤ë¥˜ëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì „ì—ëŠ” ë‹¨ìˆœí•˜ê²Œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì‹œì— íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë„ í•¨ê»˜ ì •ë¦¬í•´ì£¼ê² ê±°ë‹ˆ í•˜ê³  ë„˜ì–´ê°”ë˜ ë‚´ìš©ì´ì§€ë§Œ ë³¸ ê¸€ì—ì„œëŠ” ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œ ê°„ë‹¨íˆ(?) ì‚´í´ë³´ê³ ì í•œë‹¤.</p>
<h2 id="strace-ë¡œ-ì‚½ì§ˆ-í¬ì¸íŠ¸-ì°¾ê¸°">strace ë¡œ ì‚½ì§ˆ í¬ì¸íŠ¸ ì°¾ê¸° <a href="#strace-%eb%a1%9c-%ec%82%bd%ec%a7%88-%ed%8f%ac%ec%9d%b8%ed%8a%b8-%ec%b0%be%ea%b8%b0" class="anchor">ğŸ”—</a></h2><p>ì—…ë¬´ì™€ëŠ” ê´€ë ¨ì´ ì—†ì§€ë§Œ ê°„í˜¹ ì½”ë“œì— openë§Œ ìˆëŠ”ë°ë„ ë¶ˆêµ¬í•˜ê³  íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì— ëŒ€í•œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ë¶ˆí¸í•œ ì½”ë“œë“¤ì„ ë³´ë©´ì„œ í‰ì†Œì— ê¶ê¸ˆí–ˆë˜ ë¶€ë¶„ì´ë¼ ì ê¹ ì´ ë¶€ë¶„ì„ ì°¾ì•„ë³´ê¸°ë¡œ í–ˆë‹¤. ë¨¼ì € ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•œ ì½”ë“œë¥¼ í•˜ë‚˜ ì‘ì„±í•œ ë’¤ ì»´íŒŒì¼í•´ì¤€ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#080;font-style:italic">// cat sysclose_test.c
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span><span style="color:#080">#include</span> <span style="color:#080">&lt;unistd.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;stdlib.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;syscall.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080">#include</span> <span style="color:#080">&lt;fcntl.h&gt;</span><span style="color:#080">
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">main</span>(<span style="color:#0b0;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#0b0;font-weight:bold">int</span> fd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        fd <span style="color:#666">=</span> <span style="color:#00a000">open</span>(<span style="color:#b44">&#34;test&#34;</span>, O_RDWR);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#00a000">exit</span>(<span style="color:#666">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ë§ˆì§€ë§‰ ë¼ì¸ì˜ <code>exit(1)</code> ë¶€ë¶„ì€ ì¶”ê°€í•˜ì§€ ì•Šì•„ë„ ì¸ìë§Œ ë‹¤ë¥¸ ì±„ë¡œ ë™ì¼í•œ ì‹œìŠ¤í…œ ì½œì´ í˜¸ì¶œëœë‹¤. ì´ì œ strace ë¥¼ í†µí•´ ì‹œìŠ¤í…œì½œì´ ì–´ë–»ê²Œ í˜¸ì¶œë˜ëŠ”ì§€ ì‚´í´ë³´ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ strace ./sysclose_test
</span></span><span style="display:flex;"><span>execve<span style="color:#666">(</span><span style="color:#b44">&#34;./sysclose_test&#34;</span>, <span style="color:#666">[</span><span style="color:#b44">&#34;./sysclose_test&#34;</span><span style="color:#666">]</span>, 0x7fff0fb6ea80 /* <span style="color:#666">40</span> vars */<span style="color:#666">)</span> <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>mmap<span style="color:#666">(</span>0x7fcdffece000, 360448, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1bc000<span style="color:#666">)</span> <span style="color:#666">=</span> 0x7fcdffece000
</span></span><span style="display:flex;"><span>mmap<span style="color:#666">(</span>0x7fcdfff27000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x214000<span style="color:#666">)</span> <span style="color:#666">=</span> 0x7fcdfff27000
</span></span><span style="display:flex;"><span>mmap<span style="color:#666">(</span>0x7fcdfff2d000, 52816, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0<span style="color:#666">)</span> <span style="color:#666">=</span> 0x7fcdfff2d000
</span></span><span style="display:flex;"><span>close<span style="color:#666">(</span>3<span style="color:#666">)</span>                                <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>mmap<span style="color:#666">(</span>NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0<span style="color:#666">)</span> <span style="color:#666">=</span> 0x7fcdffd10000
</span></span><span style="display:flex;"><span>arch_prctl<span style="color:#666">(</span>ARCH_SET_FS, 0x7fcdfff3b5c0<span style="color:#666">)</span> <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>set_tid_address<span style="color:#666">(</span>0x7fcdfff3b890<span style="color:#666">)</span>         <span style="color:#666">=</span> <span style="color:#666">375046</span>
</span></span><span style="display:flex;"><span>set_robust_list<span style="color:#666">(</span>0x7fcdfff3b8a0, 24<span style="color:#666">)</span>     <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>mprotect<span style="color:#666">(</span>0x7fcdfff27000, 16384, PROT_READ<span style="color:#666">)</span> <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>mprotect<span style="color:#666">(</span>0x55c5fce58000, 4096, PROT_READ<span style="color:#666">)</span> <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>mprotect<span style="color:#666">(</span>0x7fcdfff81000, 8192, PROT_READ<span style="color:#666">)</span> <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>prlimit64<span style="color:#666">(</span>0, RLIMIT_STACK, NULL, <span style="color:#666">{</span><span style="color:#b8860b">rlim_cur</span><span style="color:#666">=</span>8192*1024, <span style="color:#b8860b">rlim_max</span><span style="color:#666">=</span>RLIM64_INFINITY<span style="color:#666">})</span> <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>munmap<span style="color:#666">(</span>0x7fcdfff3c000, 71131<span style="color:#666">)</span>           <span style="color:#666">=</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>openat<span style="color:#666">(</span>AT_FDCWD, <span style="color:#b44">&#34;test&#34;</span>, O_RDWR<span style="color:#666">)</span>        <span style="color:#666">=</span> <span style="color:#666">3</span>
</span></span><span style="display:flex;"><span>exit_group<span style="color:#666">(</span>0<span style="color:#666">)</span>                           <span style="color:#666">=</span> ?
</span></span><span style="display:flex;"><span>+++ exited with <span style="color:#666">0</span> +++
</span></span></code></pre></div><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì¶œë ¥ëœ ë¼ì¸ìœ¼ë¡œë¶€í„° <code>exit_group(0)</code> ì‹œìŠ¤í…œ ì½œì´ í˜¸ì¶œëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì‚½ì§ˆ í¬ì¸íŠ¸ë¥¼ ì°¾ì•˜ìœ¼ë‹ˆ ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì‚½ì§ˆí•  ì¤€ë¹„ëŠ” ë˜ì—ˆë‹¤.</p>
<h2 id="do_exit---exit_files">do_exit -&gt; exit_files <a href="#do_exit---exit_files" class="anchor">ğŸ”—</a></h2><p><code>exit_group(0)</code> ì„ ì‹œì‘ìœ¼ë¡œ í•¨ìˆ˜ì½œì„ ë”°ë¼ê°€ë‹¤ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜¸ì¶œ ê²½ë¡œë¥¼ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>-&gt; exit_group()
</span></span><span style="display:flex;"><span>    +-&gt; do_exit()
</span></span><span style="display:flex;"><span>        +-&gt; exit_files()
</span></span><span style="display:flex;"><span>            +-&gt; put_files_struct()
</span></span><span style="display:flex;"><span>                +-&gt; close_files()
</span></span></code></pre></div><p>í•µì‹¬ì€ ì¢…ë£Œë  íƒœìŠ¤í¬ì˜ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì–»ì€ ë’¤ NULLë¡œ ë°”ê¾¸ê³ , put_files_struct ì— ë¦¬ìŠ¤íŠ¸ë¥¼ ì¸ìë¡œ ë„˜ê¸°ë©´ì„œ íŒŒì¼ë“¤ì„ close í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.
ì´ ë¶€ë¶„ì„ í†µí•´ì„œ ì™œ êµ³ì´ ëª…ì‹œì ìœ¼ë¡œ close ë¥¼ í•˜ì§€ ì•Šì•„ë„ íƒœìŠ¤í¬ ì¢…ë£Œ ì‹œì— íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë“¤ì´ ì •ë¦¬ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">exit_files</span>(<span style="color:#a2f;font-weight:bold">struct</span> task_struct <span style="color:#666">*</span>tsk)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">struct</span> files_struct <span style="color:#666">*</span> files <span style="color:#666">=</span> tsk<span style="color:#666">-&gt;</span>files;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">if</span> (files) {
</span></span><span style="display:flex;"><span>		<span style="color:#00a000">io_uring_files_cancel</span>(files);
</span></span><span style="display:flex;"><span>		<span style="color:#00a000">task_lock</span>(tsk);
</span></span><span style="display:flex;"><span>		tsk<span style="color:#666">-&gt;</span>files <span style="color:#666">=</span> <span style="color:#a2f">NULL</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#00a000">task_unlock</span>(tsk);
</span></span><span style="display:flex;"><span>		<span style="color:#00a000">put_files_struct</span>(files);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">put_files_struct</span>(<span style="color:#a2f;font-weight:bold">struct</span> files_struct <span style="color:#666">*</span>files)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">if</span> (<span style="color:#00a000">atomic_dec_and_test</span>(<span style="color:#666">&amp;</span>files<span style="color:#666">-&gt;</span>count)) {
</span></span><span style="display:flex;"><span>		<span style="color:#a2f;font-weight:bold">struct</span> fdtable <span style="color:#666">*</span>fdt <span style="color:#666">=</span> <span style="color:#00a000">close_files</span>(files);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#080;font-style:italic">/* free the arrays if they are not embedded */</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a2f;font-weight:bold">if</span> (fdt <span style="color:#666">!=</span> <span style="color:#666">&amp;</span>files<span style="color:#666">-&gt;</span>fdtab)
</span></span><span style="display:flex;"><span>			<span style="color:#00a000">__free_fdtable</span>(fdt);
</span></span><span style="display:flex;"><span>		<span style="color:#00a000">kmem_cache_free</span>(files_cachep, files);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">static</span> <span style="color:#a2f;font-weight:bold">struct</span> fdtable <span style="color:#666">*</span><span style="color:#00a000">close_files</span>(<span style="color:#a2f;font-weight:bold">struct</span> files_struct <span style="color:#666">*</span> files)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">	 * It is safe to dereference the fd table without RCU or
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">	 * -&gt;file_lock because this is the last reference to the
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">	 * files structure.
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">struct</span> fdtable <span style="color:#666">*</span>fdt <span style="color:#666">=</span> <span style="color:#00a000">rcu_dereference_raw</span>(files<span style="color:#666">-&gt;</span>fdt);
</span></span><span style="display:flex;"><span>	<span style="color:#0b0;font-weight:bold">unsigned</span> <span style="color:#0b0;font-weight:bold">int</span> i, j <span style="color:#666">=</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">for</span> (;;) {
</span></span><span style="display:flex;"><span>		<span style="color:#0b0;font-weight:bold">unsigned</span> <span style="color:#0b0;font-weight:bold">long</span> set;
</span></span><span style="display:flex;"><span>		i <span style="color:#666">=</span> j <span style="color:#666">*</span> BITS_PER_LONG;
</span></span><span style="display:flex;"><span>		<span style="color:#a2f;font-weight:bold">if</span> (i <span style="color:#666">&gt;=</span> fdt<span style="color:#666">-&gt;</span>max_fds)
</span></span><span style="display:flex;"><span>			<span style="color:#a2f;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>		set <span style="color:#666">=</span> fdt<span style="color:#666">-&gt;</span>open_fds[j<span style="color:#666">++</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#a2f;font-weight:bold">while</span> (set) {
</span></span><span style="display:flex;"><span>			<span style="color:#a2f;font-weight:bold">if</span> (set <span style="color:#666">&amp;</span> <span style="color:#666">1</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#a2f;font-weight:bold">struct</span> file <span style="color:#666">*</span> file <span style="color:#666">=</span> <span style="color:#00a000">xchg</span>(<span style="color:#666">&amp;</span>fdt<span style="color:#666">-&gt;</span>fd[i], <span style="color:#a2f">NULL</span>);
</span></span><span style="display:flex;"><span>				<span style="color:#a2f;font-weight:bold">if</span> (file) {
</span></span><span style="display:flex;"><span>					<span style="color:#00a000">filp_close</span>(file, files);
</span></span><span style="display:flex;"><span>					<span style="color:#00a000">cond_resched</span>();
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			i<span style="color:#666">++</span>;
</span></span><span style="display:flex;"><span>			set <span style="color:#666">&gt;&gt;=</span> <span style="color:#666">1</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">return</span> fdt;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©° <a href="#%eb%a7%88%ec%b9%98%eb%a9%b0" class="anchor">ğŸ”—</a></h2><p>íŒŒì¼ì´ ë‹«íˆëŠ” ê²ƒê¹Œì§€ ì»¤ë„ ì½”ë“œë¥¼ ì½ê³  ë¶„ì„í•˜ëŠ”ë° ì‹œê°„ì´ ê½¤ ê±¸ë¦´ ê²ƒì´ë¼ ìƒê°í–ˆì§€ë§Œ ìƒê°ë³´ë‹¤ ë‹¨ê³„ê°€ ë‹¨ìˆœí•˜ì—¬ ê¸ˆë°© ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤.
í•œê°€ì§€ ì¤‘ìš”í•œ ê²ƒì€, ë³¸ ê¸€ì—ì„œ ë¶„ì„í•œ ë‚´ìš©ì´ ì½”ë“œ ìƒì—ì„œ close()ë¥¼ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì˜ë¯¸ëŠ” ì•„ë‹ˆë¼ëŠ” ì ì´ë‹¤. ë¦¬ëˆ…ìŠ¤ì—ì„œëŠ” ë””ë°”ì´ìŠ¤ ë…¸ë“œë¡œì¨ ë””ë°”ì´ìŠ¤ë¥¼ ì»¨íŠ¸ë¡¤í•œë‹¤. ì´ ê²½ìš° open()ê³¼ close()ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë””ë°”ì´ìŠ¤ ì´ˆê¸°í™” ì‹œì ì„ ì½”ë“œë¡œì¨ ê¸°ìˆ í•  ìˆ˜ ì—†ê²Œ ë˜ë¯€ë¡œ ë¬¸ì œê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ê¸° ë•Œë¬¸ì— ì£¼ì˜í•´ì•¼ í•œë‹¤.</p>

    </div>

    
        <div class="tags">
            
                <a href="https://seokbeomkim.github.io/tags/file-descriptor">file descriptor</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
        Copyright - Sukbeom Kim
    
    </div>

    
</footer>



  </body>
</html>
