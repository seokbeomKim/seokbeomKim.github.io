<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>ì•ˆë“œë¡œì´ë“œì˜ uevent, ueventd | Sukbeom Kim</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="ê°œìš” ğŸ”—ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ì™€ ì¹´ë©”ë¼ í¬íŒ…ì— ê´€ë ¨ëœ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ì½”ë“œë¥¼ ì ì ˆí•˜ê²Œ ìˆ˜ì •í•œ ë’¤ì—ë„ ê³„ì†í•´ì„œ ë””ë°”ì´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šì•˜ë‹¤. ë¡œê·¸ ìƒìœ¼ë¡œëŠ” ë””ë°”">
<meta name="generator" content="Hugo 0.121.2">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">


  
    
    <link rel="stylesheet" href="/css/img.css">
  

  
    
    <link rel="stylesheet" href="/css/noto_sans_kr.css">
  

  
    
    <link rel="stylesheet" href="/css/nanumgothic.css">
  


<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-Y7VW74D2P3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
	  <a class="button" href="/index.xml">Subscribe</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">ì•ˆë“œë¡œì´ë“œì˜ uevent, ueventd</h1>

    <div class="tip">
        <time datetime="2020-01-30 23:34:30 &#43;0900 KST">Jan 30, 2020</time>
        <span class="split">
          Â·
        </span>
        <span>
          1639 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          4 minute read
        </span>
    </div>

    
    
        
  


    


    <div class="content">
      <h1 id="ê°œìš”">ê°œìš” <a href="#%ea%b0%9c%ec%9a%94" class="anchor">ğŸ”—</a></h1><p>ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ì™€ ì¹´ë©”ë¼ í¬íŒ…ì— ê´€ë ¨ëœ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ ì½”ë“œë¥¼ ì ì ˆí•˜ê²Œ ìˆ˜ì •í•œ ë’¤ì—ë„ ê³„ì†í•´ì„œ ë””ë°”ì´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šì•˜ë‹¤. ë¡œê·¸ ìƒìœ¼ë¡œëŠ” ë””ë°”ì´ìŠ¤ OPENì— ì‹¤íŒ¨í•˜ëŠ” ê²ƒìœ¼ë¡œ ë‚˜ì™”ëŠ”ë°, ì›ì¸ì€ ë‹¤ë¥¸ ê³³ì— ìˆì—ˆë‹¤. <code>ueventd.rc</code> íŒŒì¼ì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ ê´€ë ¨ëœ ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ì— ëŒ€í•œ ê¶Œí•œì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ë˜ ê²ƒì´ ë¬¸ì œì˜€ë‹¤.</p>
<p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” <code>uevent</code>ì™€ <code>ueventd</code>ê°€ ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ê³  ì•ˆë“œë¡œì´ë“œ init ê³¼ì •ì—ì„œ ì–´ë–»ê²Œ í™œìš©ë˜ëŠ”ì§€ ì‚´í´ë³´ê¸°ë¡œ í•œë‹¤.</p>
<p>ì—¬ë‹´ìœ¼ë¡œ ì•ˆë“œë¡œì´ë“œì˜ ueventëŠ” ë¦¬ëˆ…ìŠ¤ì˜ udev ì™€ ë¹„ìŠ·í•œ ì—­í• ì„ í•˜ë©´ì„œë„ ì¡°ê¸ˆ ë‹¤ë¥´ë‹¤. ë¦¬ëˆ…ìŠ¤ì˜ ì¼ë°˜ì ì¸ í™˜ê²½ êµ¬ì„±ì´ devfs + udev ë¡œ ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ë“¤ì„ ê´€ë¦¬í•œë‹¤ë©´, ì•ˆë“œë¡œì´ë“œëŠ” <code>ueventd</code>ë¥¼ ì´ìš©í•˜ì—¬ ë…¸ë“œ íŒŒì¼ë“¤ì„ ê´€ë¦¬í•œë‹¤.</p>
<h1 id="uevent--ueventd">uevent &amp; ueventd <a href="#uevent--ueventd" class="anchor">ğŸ”—</a></h1><p>ë¦¬ëˆ…ìŠ¤ì—ì„œëŠ” ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ <code>mknod</code> ìœ í‹¸ë¦¬í‹°ë¥¼ ì œê³µí•˜ì§€ë§Œ ì•ˆë“œë¡œì´ë“œì—ì„œëŠ” ë³´ì•ˆ ë¬¸ì œë¡œ ì´ë¥¼ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤. ë•Œë¬¸ì—, ì•ˆë“œë¡œì´ë“œì˜ init í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ë˜ì˜ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìƒì„±í•œë‹¤.</p>
<ul>
<li>hot plug: ì‹œìŠ¤í…œ ë™ì‘ ì¤‘ ë””ë°”ì´ìŠ¤ ì¥ì¹˜ê°€ ì‚½ì…ë  ë•Œ ì´ì— ëŒ€í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¡œ <code>ueventd</code>ë¥¼ ê±°ì³ í•´ë‹¹ ì¥ì¹˜ì˜ ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•œë‹¤.</li>
<li>cold plug: ë¯¸ë¦¬ ì •ì˜ëœ ë””ë°”ì´ìŠ¤ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ init í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë  ë•Œ ì¼ê´„ì ìœ¼ë¡œ ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ì„ ìƒì„±í•œë‹¤.</li>
</ul>
<p>ì¶œì²˜ì— ë”°ë¥´ë©´ cold plug ë°©ì‹ì— ëŒ€í•´ì„œ, <code>ueventd</code>ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ /sys ë””ë ‰í† ë¦¬ ì•„ë˜ì— ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì •ë³´ë“¤ì„ ì €ì¥í•œ í›„, <code>ueventd</code>ê°€ ì‹¤í–‰ë˜ë©´ì„œ ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìƒì„±í•˜ì§€ ëª»í•œ ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ì— ëŒ€í•´ì„œ ê°•ì œë¡œ uevent ë¥¼ ë°œìƒì‹œì¼œ cold plug ì²˜ë¦¬ë¥¼ í•œë‹¤ê³  ì„¤ëª…í•˜ê³  ìˆë‹¤.</p>
<h1 id="init-processì™€-ueventd">init processì™€ ueventd <a href="#init-process%ec%99%80-ueventd" class="anchor">ğŸ”—</a></h1><p>ì•ˆë“œë¡œì´ë“œ init ê³¼ì •ì—ì„œ <code>ueventd</code>ë¥¼ ë¶€ë¥¸ë‹¤. <code>ueventd</code> ì—ì„œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì•„ë˜ì˜ <code>ueventd_main</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">ueventd_main</span>(<span style="color:#0b0;font-weight:bold">int</span> argc, <span style="color:#0b0;font-weight:bold">char</span> <span style="color:#666">**</span>argv)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">struct</span> <span style="color:#00f">pollfd</span> ufd;
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">int</span> nr;
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">char</span> tmp[<span style="color:#666">32</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-style:italic">/* Prevent fire-and-forget children from becoming zombies.
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">    * If we should need to wait() for some children in the future
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">    * (as opposed to none right now), double-forking here instead
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">    * of ignoring SIGCHLD may be the better solution.
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">    */</span>
</span></span><span style="display:flex;"><span>    signal(SIGCHLD, SIG_IGN);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    open_devnull_stdio();
</span></span><span style="display:flex;"><span>    klog_init();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    INFO(<span style="">â€œ</span>starting ueventd<span style="">\</span>n<span style="">â€</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-style:italic">/* Respect hardware passed in through the kernel cmd line. Here we will look
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * for androidboot.hardware param in kernel cmdline, and save its value in
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * hardware[]. */</span>
</span></span><span style="display:flex;"><span>    import_kernel_cmdline(<span style="color:#666">0</span>, import_kernel_nv);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    get_hardware_name(hardware, <span style="color:#666">&amp;</span>revision);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ueventd_parse_config_file(<span style="">â€œ</span><span style="color:#666">/</span>ueventd.rc<span style="">â€</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    snprintf(tmp, <span style="color:#a2f;font-weight:bold">sizeof</span>(tmp), <span style="">â€œ</span><span style="color:#666">/</span>ueventd.<span style="color:#666">%</span>s.rc<span style="">â€</span>, hardware);
</span></span><span style="display:flex;"><span>    ueventd_parse_config_file(tmp);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    device_init();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ufd.events <span style="color:#666">=</span> POLLIN;
</span></span><span style="display:flex;"><span>    ufd.fd <span style="color:#666">=</span> get_device_fd();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">while</span>(<span style="color:#666">1</span>) {
</span></span><span style="display:flex;"><span>        ufd.revents <span style="color:#666">=</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>        nr <span style="color:#666">=</span> poll(<span style="color:#666">&amp;</span>ufd, <span style="color:#666">1</span>, <span style="color:#666">-</span><span style="color:#666">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span> (nr <span style="color:#666">&lt;=</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span> (ufd.revents <span style="color:#666">==</span> POLLIN)
</span></span><span style="display:flex;"><span>               handle_device_fd();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ì—¬ê¸°ì„œ ì¤‘ìš”í•œ í•¨ìˆ˜ëŠ” <code>ueventd_parse_config_file</code>ì™€ <code>device_init</code>í•¨ìˆ˜ì´ë‹¤. <code>ueventd_parse_config_file</code>í•¨ìˆ˜ëŠ” <code>ueventd.rc</code>íŒŒì¼ê³¼ <code>ueventd.%hardware%.rc</code> íŒŒì¼ì„ ì½ì–´ ë””ë°”ì´ìŠ¤ ë…¸ë“œ íŒŒì¼ì„ ë§Œë“œëŠ” ì •ë³´ë¥¼ ì–»ëŠ”ë‹¤. ì´ íŒŒì¼ì— ì €ì¥ë˜ì–´ ìˆëŠ” ì •ë³´ëŠ” device ì´ë¦„, permission, gid, uid ì´ë‹¤. ì•„ë˜ëŠ” ì—…ë¬´ì—ì„œ ì‚¬ìš©í•œ ì‹¤ì œ ueventd.rc íŒŒì¼ë¡œì„œ ë¬¸ì œê°€ ëœ videosourceì— ëŒ€í•œ ë‚´ìš©ë“¤ì´ ì¶”ê°€ë˜ì–´ì•¼ í–ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/dev/switch_gpio_reverse	0666	system		system
</span></span><span style="display:flex;"><span>#/dev/videosource* ë¡œ ê°€ëŠ¥
</span></span><span style="display:flex;"><span>/dev/videosource0	0666	system		system
</span></span><span style="display:flex;"><span>/dev/videosource1	0666	system		system
</span></span></code></pre></div><p>ì´ ë•Œ, ë³„ë„ë¡œ ì €ì¥ë˜ì–´ ìˆì§€ ì•ŠëŠ” ë””ë°”ì´ìŠ¤ëŠ” ë””í´íŠ¸ë¡œ 600, 0, 0ì´ ì„¸íŒ…ëœë‹¤. <code>device_init</code> í•¨ìˆ˜ëŠ” <code>uevent_socket</code>ì„ ì—´ê³  coldboot í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.</p>
<p>ì—¬ê¸°ì„œ ì—° ì†Œì¼“ì€ ueventë¥¼ ë³´ë‚¼ë•Œ ì“°ì´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‚˜ì¤‘ì— ë°œìƒí•œ ueventë¥¼ ë°›ì„ë•Œ ì“°ì¸ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">device_init</span>(<span style="color:#0b0;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    suseconds_t t0, t1;
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">struct</span> <span style="color:#00f">stat</span> info;
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">int</span> fd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-style:italic">/* is 64K enough? udev uses 16MB! */</span>
</span></span><span style="display:flex;"><span>    device_fd <span style="color:#666">=</span> uevent_open_socket(<span style="color:#666">64</span><span style="color:#666">*</span><span style="color:#666">1024</span>, <span style="color:#a2f">true</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">if</span>(device_fd <span style="color:#666">&lt;</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    fcntl(device_fd, F_SETFD, FD_CLOEXEC);
</span></span><span style="display:flex;"><span>    fcntl(device_fd, F_SETFL, O_NONBLOCK);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">if</span> (stat(coldboot_done, <span style="color:#666">&amp;</span>info) <span style="color:#666">&lt;</span> <span style="color:#666">0</span>) {
</span></span><span style="display:flex;"><span>        t0 <span style="color:#666">=</span> get_usecs();
</span></span><span style="display:flex;"><span>        coldboot(<span style="">â€œ</span><span style="color:#666">/</span>sys<span style="color:#666">/</span><span style="color:#a2f;font-weight:bold">class</span><span style="">â€);</span>
</span></span><span style="display:flex;"><span>        coldboot(<span style="">â€œ</span><span style="color:#666">/</span>sys<span style="color:#666">/</span>block<span style="">â€</span>);
</span></span><span style="display:flex;"><span>        coldboot(<span style="">â€œ</span><span style="color:#666">/</span>sys<span style="color:#666">/</span>devices<span style="">â€</span>);
</span></span><span style="display:flex;"><span>        t1 <span style="color:#666">=</span> get_usecs();
</span></span><span style="display:flex;"><span>        fd <span style="color:#666">=</span> open(coldboot_done, O_WRONLY<span style="color:#666">|</span>O_CREAT, <span style="color:#666">0000</span>);
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        log_event_print(<span style="">â€œ</span>coldboot <span style="color:#666">%</span>ld uS<span style="">\</span>n<span style="">â€</span>, ((<span style="color:#0b0;font-weight:bold">long</span>) (t1 <span style="">â€“</span> t0)));
</span></span><span style="display:flex;"><span>    } <span style="color:#a2f;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        log_event_print(<span style="">â€œ</span>skipping coldboot, already done<span style="">\</span>n<span style="">â€</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>í˜¸ì¶œë˜ëŠ” coldbootëŠ” ë‚´ë¶€ì ìœ¼ë¡œ <code>do_coldboot</code>ë¥¼ í˜¸ì¶œí•œë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">static</span> <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">do_coldboot</span>(DIR <span style="color:#666">*</span>d)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">struct</span> <span style="color:#00f">dirent</span> <span style="color:#666">*</span>de;
</span></span><span style="display:flex;"><span>    <span style="color:#0b0;font-weight:bold">int</span> dfd, fd;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dfd <span style="color:#666">=</span> dirfd(d);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    fd <span style="color:#666">=</span> openat(dfd, <span style="">â€œ</span>uevent<span style="">â€</span>, O_WRONLY);
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">if</span>(fd <span style="color:#666">&gt;=</span> <span style="color:#666">0</span>) {
</span></span><span style="display:flex;"><span>        write(fd, <span style="">â€œ</span>add<span style="">\</span>n<span style="">â€</span>, <span style="color:#666">4</span>);
</span></span><span style="display:flex;"><span>        close(fd);
</span></span><span style="display:flex;"><span>        handle_device_fd();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">while</span>((de <span style="color:#666">=</span> readdir(d))) {
</span></span><span style="display:flex;"><span>        DIR <span style="color:#666">*</span>d2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(de<span style="color:#666">-&gt;</span>d_type <span style="color:#666">!=</span> DT_DIR <span style="color:#666">||</span> de<span style="color:#666">-&gt;</span>d_name[<span style="color:#666">0</span>] <span style="color:#666">==</span> <span style="">â€˜</span>.<span style="">â€™</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        fd <span style="color:#666">=</span> openat(dfd, de<span style="color:#666">-&gt;</span>d_name, O_RDONLY <span style="color:#666">|</span> O_DIRECTORY);
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(fd <span style="color:#666">&lt;</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a2f;font-weight:bold">continue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        d2 <span style="color:#666">=</span> fdopendir(fd);
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">if</span>(d2 <span style="color:#666">==</span> <span style="color:#666">0</span>)
</span></span><span style="display:flex;"><span>            close(fd);
</span></span><span style="display:flex;"><span>        <span style="color:#a2f;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            do_coldboot(d2);
</span></span><span style="display:flex;"><span>            closedir(d2);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ìƒì„±í•˜ì§€ ëª»í•œ ë””ë°”ì´ìŠ¤ê°€ ì €ì¥í•œ /sys ë°‘ì˜ ê°ê°ì˜ í•´ë‹¹ í´ë”ë¥¼ ë“¤ì–´ê°€ <code>uevent</code> íŒŒì¼ì— â€œaddâ€ ë©”ì‹œì§€ë¥¼ ì¨ë„£ì–´ ê°•ì œë¡œ ueventë¥¼ ë°œìƒì‹œí‚¨ë‹¤. ê·¸ í›„ <code>handle_device_fd</code> í•¨ìˆ˜ë¥¼ í†µí•´ <code>uevent</code> ë¥¼ íŒŒì‹±í•´ ë””ë°”ì´ìŠ¤ ë…¸ë“œë¥¼ ë§Œë“ ë‹¤. ì´ ê³¼ì •ì—ì„œ <code>ueventd_parse_config_file</code> ì—ì„œ ì–»ì–´ì˜¨ ì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.</p>
<h1 id="ì¶œì²˜">ì¶œì²˜ <a href="#%ec%b6%9c%ec%b2%98" class="anchor">ğŸ”—</a></h1><ul>
<li><a href="https://kshokd.wordpress.com/2012/08/29/init-%EA%B3%BC%EC%A0%95%EC%97%90%EC%84%9C-uevent%EC%99%80-ueventd%EC%9D%98-%ED%99%9C%EC%9A%A9/" target="_blank" rel="noopener">https://kshokd.wordpress.com/2012/08/29/init-%EA%B3%BC%EC%A0%95%EC%97%90%EC%84%9C-uevent%EC%99%80-ueventd%EC%9D%98-%ED%99%9C%EC%9A%A9/</a></li>
</ul>

    </div>

    
        <div class="tags">
            
                <a href="/tags/uevent">uevent</a>
            
                <a href="/tags/ueventd">ueventd</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
        Copyright - Sukbeom Kim
    
    </div>

    
</footer>



  </body>
</html>
