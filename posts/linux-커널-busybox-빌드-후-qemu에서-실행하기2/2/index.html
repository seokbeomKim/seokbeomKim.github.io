<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Linux ì»¤ë„, Busybox ë¹Œë“œ í›„ QEMUì—ì„œ ì‹¤í–‰í•˜ê¸°(2/2) | Sukbeom Kim</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="ì§€ë‚œ ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë‹¨ìˆœí•˜ê¸° initramfs ë¨ë””ìŠ¤í¬ë¥¼ ë§Œë“¤ì–´ busyboxì— ì˜¬ë¦¬ëŠ” ë°©ë²•ì„ ê¸°ìˆ í–ˆì—ˆë‹¤. ê·¸ëŸ¬ë©´ì„œ ë¨ë””ìŠ¤í¬ê°€ ë¬´ì—‡ì¸ì§€ busyboxëŠ” ë¬´ì—‡ì¸ì§€, ê·¸ë¦¬">
<meta name="generator" content="Hugo 0.121.2">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">


  
    
    <link rel="stylesheet" href="/css/img.css">
  

  
    
    <link rel="stylesheet" href="/css/noto_sans_kr.css">
  

  
    
    <link rel="stylesheet" href="/css/nanumgothic.css">
  


<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-Y7VW74D2P3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
	  <a class="button" href="/index.xml">Subscribe</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Linux ì»¤ë„, Busybox ë¹Œë“œ í›„ QEMUì—ì„œ ì‹¤í–‰í•˜ê¸°(2/2)</h1>

    <div class="tip">
        <time datetime="2019-05-23 15:10:46 &#43;0900 KST">May 23, 2019</time>
        <span class="split">
          Â·
        </span>
        <span>
          1421 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          3 minute read
        </span>
    </div>

    
    
        
  


    


    <div class="content">
      <p>ì§€ë‚œ ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ë‹¨ìˆœí•˜ê¸° initramfs ë¨ë””ìŠ¤í¬ë¥¼ ë§Œë“¤ì–´ busyboxì—
ì˜¬ë¦¬ëŠ” ë°©ë²•ì„ ê¸°ìˆ í–ˆì—ˆë‹¤. ê·¸ëŸ¬ë©´ì„œ ë¨ë””ìŠ¤í¬ê°€ ë¬´ì—‡ì¸ì§€ busyboxëŠ”
ë¬´ì—‡ì¸ì§€, ê·¸ë¦¬ê³  ëŒ€ëµì ì¸ ë¹Œë“œ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆì—ˆë˜
ê¸°íšŒì˜€ë‹¤.</p>
<p>ë‘ ë²ˆì§¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì§ì ‘ busyboxë¥¼ ë¹Œë“œí•˜ì§€ ì•Šê³  <code>crosstool-ng</code>ë¼ëŠ”
í¬ë¡œìŠ¤ ì»´íŒŒì¼ëŸ¬ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ë„êµ¬ì™€ <code>buildroot</code>ë¼ëŠ” Makefile íŒ¨í‚¤ì§€ë¥¼
ì´ìš©í•˜ì—¬ ë¨ë””ìŠ¤í¬ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì— ëŒ€í•´ ê¸°ìˆ í•˜ê² ë‹¤.</p>
<h1 id="crosstool-ng-ì´ìš©í•˜ì—¬-í¬ë¡œìŠ¤-ì»´íŒŒì¼ëŸ¬-ë§Œë“¤ê¸°">Crosstool-ng ì´ìš©í•˜ì—¬ í¬ë¡œìŠ¤ ì»´íŒŒì¼ëŸ¬ ë§Œë“¤ê¸° <a href="#crosstool-ng-%ec%9d%b4%ec%9a%a9%ed%95%98%ec%97%ac-%ed%81%ac%eb%a1%9c%ec%8a%a4-%ec%bb%b4%ed%8c%8c%ec%9d%bc%eb%9f%ac-%eb%a7%8c%eb%93%a4%ea%b8%b0" class="anchor">ğŸ”—</a></h1><p>crosstool-ngëŠ” ë¯¸ë¦¬ ì„¤ì •ëœ configë¥¼ ì´ìš©í•´ ì†ì‰½ê²Œ í¬ë¡œìŠ¤ ì»´íŒŒì¼ëŸ¬ë¥¼
ë§Œë“¤ ìˆ˜ ìˆëŠ” íŒ¨í‚¤ì§€ì´ë‹¤. ì´ë¥¼ ì–´ë–»ê²Œ ì´ìš©í•˜ëŠ”ì§€ ìì„¸íˆ ì„¤ëª…í•˜ê² ë‹¤.</p>
<p>ë¨¼ì € crosstool-ngë¥¼ ë°›ëŠ”ë‹¤. ì´ ë•Œ,
<a href="https://github.com/crosstool-ng/crosstool-ng" target="_blank" rel="noopener">ê¹ƒí—ˆë¸Œ</a>ì— ìˆëŠ” ê²½ë¡œë¥¼
ì´ìš©í•´ ì§ì ‘ ë°›ì•„ì“°ëŠ” ê²½ìš°ê°€ ìˆì„í…ë° ë§Œì•½, ë°›ì•„ì“°ëŠ” ê²½ìš°ë¼ë©´ ë°˜ë“œì‹œ
ë¦´ë¦¬ì¦ˆ ë²„ì „ìœ¼ë¡œ checkoutí•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. masterë¡œ ê·¸ëƒ¥ ë°›ì•„ì„œ
ì‚¬ìš©í•˜ë©´ ì´ìƒí•œë°ì„œ ê³ ìƒí•˜ê²Œ ëœë‹¤. gitì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ”
<a href="http://crosstool-ng.org/download/crosstool-ng/" target="_blank" rel="noopener">ì—¬ê¸°</a>ë¥¼ í†µí•´
í™ˆí˜ì´ì§€ì—ì„œ ì§ì ‘ ë°›ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p>
<p>$ git clone <a href="https://github.com/crosstool-ng/crosstool-ng" target="_blank" rel="noopener">https://github.com/crosstool-ng/crosstool-ng</a>
$ git fetch &ndash;all
$ git checkout tags/crosstool-ng-1.24.0-rc3</p>
<p>ì••ì¶•ì„ í‘¼ í›„ ë‚´ë¶€ì—ì„œ ì•„ë˜ì™€ ê°ˆì´ ì„¤ì •í•´ì¤€ë‹¤.</p>
<p>$ ./configure &ndash;local
$ make
$ make install</p>
<p>ì´ì œ í¬ë¡œìŠ¤ì»´íŒŒì¼ëŸ¬ë¥¼ ë§Œë“¤ì–´ë³´ì. ì»´íŒŒì¼ëŸ¬ ìƒì„±ì„ ìœ„í•´ í•„ìš”í•œ
íŒ¨í‚¤ì§€(binutls, glibc, gcc, mpc, flex..ë“±ë“±)ë“¤ì„ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³ 
ë¹Œë“œí•œë‹¤. ì˜ˆì „ LFS(Linux from scratch)ì—ì„œ ì´ ë°©ë²•ì„ ì¼ë‹¤ë©´ ì •ë§ë¡œ
í¸í•˜ê²Œ ì‘ì—…í•  ìˆ˜ ìˆì—ˆì„í…ë° í•˜ëŠ” ì•„ì‰¬ì›€ì´ ë‚¨ëŠ” ìˆœê°„ì´ì—ˆë‹¤.</p>
<p>ì•„ë˜ì™€ ê°™ì´ <code>list-samples</code> ì˜µì…˜ì„ ì£¼ì–´ ì‹¤í–‰í•˜ë©´ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒ˜í”Œ
ëª©ë¡ë“¤ì´ ì¶œë ¥ëœë‹¤. ì—¬ê¸°ì— ì—†ë‹¤ë©´ ì•ìœ¼ë¡œ ìˆ˜í–‰í•  menuconfigì—ì„œ í•„ìš”í•œ
ì„¤ì •ë“¤ì„ ì§ì ‘ í•´ì£¼ì–´ì•¼ í•œë‹¤.</p>
<p>root@19893213a218:~/Workspaces/crosstool-ng# ./ct-ng list-samples
Status  Sample name
(ìƒëµ)
&hellip;
[L&hellip;]   x86_64-multilib-linux-gnu
[L..X]   x86_64-multilib-linux-musl
[L&hellip;]   x86_64-multilib-linux-uclibc
[L..X]   x86_64-w64-mingw32,x86_64-pc-linux-gnu
[L&hellip;]   x86_64-ubuntu12.04-linux-gnu
[L&hellip;]   x86_64-ubuntu14.04-linux-gnu
[L&hellip;]   x86_64-ubuntu16.04-linux-gnu
[L&hellip;]   x86_64-unknown-linux-gnu
[L&hellip;]   x86_64-unknown-linux-uclibc
[L..X]   x86_64-w64-mingw32
[L..X]   xtensa-fsf-elf
[L&hellip;]   xtensa-fsf-linux-uclibc</p>
<p>L (Local)       : sample was found in current directory
G (Global)      : sample was installed with crosstool-NG
X (EXPERIMENTAL): sample may use EXPERIMENTAL features
B (BROKEN)      : sample is currently broken
O (OBSOLETE)    : sample needs to be upgraded</p>
<p>ì»¤ë„ í•´í‚¹ì„ ìœ„í•œ ê²ƒì´ì§€ë§Œ ì„ë² ë””ë“œìš©
ì»¤ë„ì„ ì‚´í´ë³¼ ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— í•„ìëŠ” <code>x86_64-unknown-linux-gnu</code>ë¥¼
ì„ íƒí•˜ì˜€ë‹¤.</p>
<p>$ ./ct-ng x86_64-unknown-linux-gnu
$ ./ct-ng menuconfig # ì˜µì…˜ì„ ì¶”ê°€ë¡œ ì„ íƒí•  ê²½ìš°
$ ./ct-ng build</p>
<h1 id="buildroot-ì´ìš©í•˜ì—¬-rootfs-ë§Œë“¤ê¸°">BuildRoot ì´ìš©í•˜ì—¬ rootfs ë§Œë“¤ê¸° <a href="#buildroot-%ec%9d%b4%ec%9a%a9%ed%95%98%ec%97%ac-rootfs-%eb%a7%8c%eb%93%a4%ea%b8%b0" class="anchor">ğŸ”—</a></h1><p>ì•ì„œ ë¹Œë“œí•œ í¬ë¡œìŠ¤ ì»´íŒŒì¼ëŸ¬ë“¤ì„
/opt/crosstool/x86_64-unknown-linux-gnu ê²½ë¡œì— ì„¤ì¹˜í–ˆë‹¤ê³  ê°€ì •í•˜ê³ 
<code>buildroot</code>ë¥¼ ì´ìš©í•˜ì—¬ ì´ë¯¸ì§€ íŒŒì¼ì„ ìƒì„±í•œë‹¤. buildroot ë¥¼ ì´ìš©í• 
ê²½ìš° í¬ë¡œìŠ¤ì»´íŒŒì¼ëŸ¬ë¥¼ ì´ìš©í•´ ì»´íŒŒì¼í•œ ì‘ìš© í”„ë¡œê·¸ë¨ê³¼ ì»¤ë„ ëª¨ë“ˆì„ í•¨ê»˜
ë¹Œë“œí•˜ì—¬ ì¶”ê°€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìš©ì´í•˜ë‹¤.</p>
<p>$ export BUILDROOT=$OPT/buildroot
$ export BUILDROOT_BUILD=$BUILDS/buildroot
$ mkdir -p $BUILDROOT_BUILD
$ cd $BUILDROOT_BUILD
$ touch Config.in external.mk
$ echo &rsquo;name: mini_linux&rsquo; &gt; external.desc
$ echo &lsquo;desc: minimal linux system with buildroot&rsquo; &raquo; external.desc
$ mkdir configs overlay
$ cd $BUILDROOT
$ make O=$BUILDROOT_BUILD BR2_EXTERNAL=$BUILDROOT_BUILD qemu_x86_64_defconfig
$ cd $BUILDROOT_BUILD
$ make menuconfig</p>
<p>ì´ í›„, ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì¤€ë‹¤. ì´ ë•Œ ì¤‘ìš”í•œ ê²ƒì€ <code>System configuration ---&gt; Network interface to configure through DHCP</code> ë¶€ë¶„ì„ ë¹ˆì¹¸ìœ¼ë¡œ
í•´ì¤˜ì•¼í•œë‹¤ëŠ” ì ì´ë‹¤. ê¸°ë³¸ê°’ì´ eth0ìœ¼ë¡œ ë˜ì–´ìˆì„í…ë°, init ìŠ¤í¬ë¦½íŠ¸ì—ì„œ
í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©° ì—†ì„ ê²½ìš°ì—ëŠ” ì…¸ì´ ì‹¤í–‰ë˜ì§€
ì•Šê²Œëœë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Build options ---&gt; Location to save buildroot config ---&gt; $(BR2_EXTERNAL)/configs/mini_linux_defconfig
</span></span><span style="display:flex;"><span>Build options ---&gt; Download dir ---&gt; /some/where/buildroot_dl
</span></span><span style="display:flex;"><span>Build options ---&gt; Number of jobs to run simultaneously (0 for auto) ---&gt; 8
</span></span><span style="display:flex;"><span>Build options ---&gt; Enable compiler cache ---&gt; yes
</span></span><span style="display:flex;"><span>Build options ---&gt; Compiler cache location ---&gt; /some/where/buildroot_ccache
</span></span><span style="display:flex;"><span>Toolchain ---&gt; Toolchain type ---&gt; External toolchain
</span></span><span style="display:flex;"><span>Toolchain ---&gt; Toolchain ---&gt; Custom toolchain
</span></span><span style="display:flex;"><span>Toolchain ---&gt; Toolchain origin ---&gt; Pre-installed toolchain
</span></span><span style="display:flex;"><span>Toolchain ---&gt; Toolchain path ---&gt; /opt/toolchains/x86_64-unknown-linux-gnu
</span></span><span style="display:flex;"><span>Toolchain ---&gt; Toolchain prefix ---&gt; x86_64-unknown-linux-gnu
</span></span><span style="display:flex;"><span>Toolchain ---&gt; External toolchain gcc version ---&gt; 5.x
</span></span><span style="display:flex;"><span>Toolchain ---&gt; External toolchain kernel headers series ---&gt; 4.3.x
</span></span><span style="display:flex;"><span>Toolchain ---&gt; External toolchain C library ---&gt; glibc/eglibc
</span></span><span style="display:flex;"><span>Toolchain ---&gt; Toolchain has C++ support? ---&gt; yes
</span></span><span style="display:flex;"><span>System configuration ---&gt; System hostname ---&gt; mini_linux
</span></span><span style="display:flex;"><span>System configuration ---&gt; System banner ---&gt; Welcome to mini_linux
</span></span><span style="display:flex;"><span>System configuration ---&gt; Run a getty (login prompt) after boot ---&gt; TTY port ---&gt; ttyS0
</span></span><span style="display:flex;"><span>System configuration ---&gt; Network interface to configure through DHCP ---&gt;
</span></span><span style="display:flex;"><span>System configuration ---&gt; Root filesystem overlay directories ---&gt; $(BR2_EXTERNAL)/overlay
</span></span><span style="display:flex;"><span>Kernel ---&gt; Linux Kernel ---&gt; no
</span></span><span style="display:flex;"><span>Filesystem images ---&gt; cpio the root filesystem (for use as an initial RAM filesystem) ---&gt; yes
</span></span><span style="display:flex;"><span>Filesystem images ---&gt; Compression method ---&gt; gzip
</span></span></code></pre></div><p>ì•„ë˜ì™€ ê°™ì´ ì„¤ì • ì €ì¥ í›„ init ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì¤€ë’¤ ë¹Œë“œí•œë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>$ make savedefconfig
</span></span><span style="display:flex;"><span>$ vim $BUILDROOT_BUILD/overlay/init
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#!/bin/sh
</span></span><span style="display:flex;"><span>/bin/mount -t devtmpfs devtmpfs /dev
</span></span><span style="display:flex;"><span>/bin/mount -t proc none /proc
</span></span><span style="display:flex;"><span>/bin/mount -t sysfs none /sys
</span></span><span style="display:flex;"><span>exec 0&lt;/dev/console
</span></span><span style="display:flex;"><span>exec 1&gt;/dev/console
</span></span><span style="display:flex;"><span>exec 2&gt;/dev/console
</span></span><span style="display:flex;"><span>cat &lt;&lt;!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Boot took $(cut -d&#39; &#39; -f1 /proc/uptime) seconds
</span></span><span style="display:flex;"><span>!
</span></span><span style="display:flex;"><span>exec /bin/sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># vim ì¢…ë£Œ í›„ ìŠ¤í¬ë¦½íŠ¸ì— ê¶Œí•œ ë¶€ì—¬
</span></span><span style="display:flex;"><span>$ chmod +x overlay/init
</span></span><span style="display:flex;"><span>$ make
</span></span></code></pre></div><p>ì´ì œ qemuë¥¼ í†µí•´ ì‹¤í–‰ì‹œì¼œë³´ë©´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>qemu-system-x86_64 -kernel $LINUX_BUILD/arch/x86_64/boot/bzImage \
</span></span><span style="display:flex;"><span>  -initrd $BUILDROOT_BUILD/images/rootfs.cpio.gz -nographic \
</span></span><span style="display:flex;"><span>  -append &#34;console=ttyS0&#34;
</span></span></code></pre></div><h1 id="ì¶œì²˜">ì¶œì²˜ <a href="#%ec%b6%9c%ec%b2%98" class="anchor">ğŸ”—</a></h1><ul>
<li><a href="https://gist.github.com/seokbeomKim/9cff93b073573fe535534c522c6e53e1" target="_blank" rel="noopener">Build and run minimal
linux</a></li>
<li><a href="https://briolidz.wordpress.com/2012/02/07/building-embedded-arm-systems-with-crosstool-ng/" target="_blank" rel="noopener">Building embedded ARM systems with
Crosstool-NG</a></li>
</ul>

    </div>

    
        <div class="tags">
            
                <a href="/tags/kernel">kernel</a>
            
                <a href="/tags/buildroot">buildroot</a>
            
                <a href="/tags/busybox">busybox</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
        Copyright - Sukbeom Kim
    
    </div>

    
</footer>



  </body>
</html>
