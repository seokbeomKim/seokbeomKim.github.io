<!doctype html>
<html
  lang="en-us"
  dir="ltr"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
<meta name="language" content="en" />
<meta name="viewport" content="width=device-width" />
<title>
    Tasklet | 평범한 개발자
</title>
  <meta name="description" content="개요 사내 커널 스터디에서 교재로서 사용하고 있는 디버깅을 통해 배우는 리눅스 커널의 구조와 원리 책에서는 태스크릿 (Tasklet)을 SoftIRQ와 함께 아래와 같이 설명한다.
SoftIRQ 서비스 중 하나로 동적으로 Soft IRQ 서비스를 쓸 수 있는 인터페이스이다. 그리고 이와 함께 Tasklet의 실행 단계에 대한 내용이 자세하게 기술되어 있다.
인터럽트 핸들러에서 task_schedule() 함수를 호출해 태스크릿 스케쥴링을 실행한다. task_schedule() 함수는 raise_softirq_irqoff() 함수를 호출해 TASKLET Soft IRQ 서비스를 요청한다. Soft IRQ 서비스 핸들러를 호출하는 __do_softirq() 함수에서 태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다." />
<meta property="og:url" content="http://localhost:1313/posts/tasklet2/">
  <meta property="og:site_name" content="평범한 개발자">
  <meta property="og:title" content="Tasklet">
  <meta property="og:description" content="개요 사내 커널 스터디에서 교재로서 사용하고 있는 디버깅을 통해 배우는 리눅스 커널의 구조와 원리 책에서는 태스크릿 (Tasklet)을 SoftIRQ와 함께 아래와 같이 설명한다.
SoftIRQ 서비스 중 하나로 동적으로 Soft IRQ 서비스를 쓸 수 있는 인터페이스이다. 그리고 이와 함께 Tasklet의 실행 단계에 대한 내용이 자세하게 기술되어 있다.
인터럽트 핸들러에서 task_schedule() 함수를 호출해 태스크릿 스케쥴링을 실행한다. task_schedule() 함수는 raise_softirq_irqoff() 함수를 호출해 TASKLET Soft IRQ 서비스를 요청한다. Soft IRQ 서비스 핸들러를 호출하는 __do_softirq() 함수에서 태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-11-13T17:32:26+09:00">
    <meta property="article:modified_time" content="2022-11-13T17:32:26+09:00">
    <meta property="article:tag" content="Tasklet">


  <meta itemprop="name" content="Tasklet">
  <meta itemprop="description" content="개요 사내 커널 스터디에서 교재로서 사용하고 있는 디버깅을 통해 배우는 리눅스 커널의 구조와 원리 책에서는 태스크릿 (Tasklet)을 SoftIRQ와 함께 아래와 같이 설명한다.
SoftIRQ 서비스 중 하나로 동적으로 Soft IRQ 서비스를 쓸 수 있는 인터페이스이다. 그리고 이와 함께 Tasklet의 실행 단계에 대한 내용이 자세하게 기술되어 있다.
인터럽트 핸들러에서 task_schedule() 함수를 호출해 태스크릿 스케쥴링을 실행한다. task_schedule() 함수는 raise_softirq_irqoff() 함수를 호출해 TASKLET Soft IRQ 서비스를 요청한다. Soft IRQ 서비스 핸들러를 호출하는 __do_softirq() 함수에서 태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다.">
  <meta itemprop="datePublished" content="2022-11-13T17:32:26+09:00">
  <meta itemprop="dateModified" content="2022-11-13T17:32:26+09:00">
  <meta itemprop="wordCount" content="462">
  <meta itemprop="keywords" content="tech">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Tasklet">
  <meta name="twitter:description" content="개요 사내 커널 스터디에서 교재로서 사용하고 있는 디버깅을 통해 배우는 리눅스 커널의 구조와 원리 책에서는 태스크릿 (Tasklet)을 SoftIRQ와 함께 아래와 같이 설명한다.
SoftIRQ 서비스 중 하나로 동적으로 Soft IRQ 서비스를 쓸 수 있는 인터페이스이다. 그리고 이와 함께 Tasklet의 실행 단계에 대한 내용이 자세하게 기술되어 있다.
인터럽트 핸들러에서 task_schedule() 함수를 호출해 태스크릿 스케쥴링을 실행한다. task_schedule() 함수는 raise_softirq_irqoff() 함수를 호출해 TASKLET Soft IRQ 서비스를 요청한다. Soft IRQ 서비스 핸들러를 호출하는 __do_softirq() 함수에서 태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다.">

<link rel="canonical" href="http://localhost:1313/posts/tasklet2/" />

    <link rel="stylesheet" href="/css/index.css" />


      <script src="/js/main.js" defer></script>
  
  



<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@id": "http://localhost:1313/posts/tasklet2/",
  "@type": "BlogPosting",
  "articleSection": [
    "Kernel"
  ],
  "author": {
    "@type": "Person",
    "email": "sukbeom.kim@gmail.com",
    "name": "Sukbeom Kim",
    "url": "http://localhost:1313/about/"
  },
  "copyrightNotice": "Sukbeom Kim",
  "datePublished": "2022-11-13",
  "description": "개요 사내 커널 스터디에서 교재로서 사용하고 있는 디버깅을 통해 배우는 리눅스 커널의 구조와 원리 책에서는 태스크릿 (Tasklet)을 SoftIRQ와 함께 아래와 같이 설명한다.\nSoftIRQ 서비스 중 하나로 동적으로 Soft IRQ 서비스를 쓸 수 있는 인터페이스이다. 그리고 이와 함께 Tasklet의 실행 단계에 대한 내용이 자세하게 기술되어 있다.\n인터럽트 핸들러에서 task_schedule() 함수를 호출해 태스크릿 스케쥴링을 실행한다. task_schedule() 함수는 raise_softirq_irqoff() 함수를 호출해 TASKLET Soft IRQ 서비스를 요청한다. Soft IRQ 서비스 핸들러를 호출하는 __do_softirq() 함수에서 태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다.",
  "headline": "Tasklet",
  "isPartOf": {
    "@id": "http://localhost:1313/posts/",
    "@type": "Blog",
    "name": "Posts"
  },
  "keywords": [
    "Tasklet",
    "tech"
  ],
  "mainEntityOfPage": "http://localhost:1313/posts/tasklet2/",
  "name": "Tasklet",
  "timeRequired": "PT3M",
  "url": "http://localhost:1313/posts/tasklet2/",
  "wordCount": 462
}
</script>


  </head>
  <body>
    <div class="container mx-auto flex max-w-prose flex-col space-y-10 p-4 md:p-6">
      <header class="flex flex-row items-center justify-between">
        <div>
  <a id="skip-nav" class="sr-only" href="#maincontent">Skip to main content</a>
  <a class="font-semibold" href="/">평범한 개발자</a>
</div>

  <nav>
    <ul class="flex flex-row items-center justify-end space-x-4">
    <li>
      <a aria-current="true" class="ancestor" href="/posts/">Posts</a
      >
    </li>
    <li>
      <a href="/graph/">Graph</a
      >
    </li>
    <li>
      <a href="/about/">About</a
      >
    </li>
    </ul>
  </nav>


      </header>
      <main class="prose prose-slate relative md:prose-lg prose-h1:text-[2em]" id="maincontent">
        <article class="main">
    <header>
      <h1 class="!mb-1">Tasklet</h1><div class="flex flex-row items-center space-x-4">
          <time class="text-sm italic opacity-80" datetime="2022-11-13T17:32:26&#43;09:00"
            >November 13, 2022</time
          >
        </div>
    </header>

    <h2 id="개요" class="scroll-mt-8 group">
  개요
  
    <a href="#%ea%b0%9c%ec%9a%94"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<p>사내 커널 스터디에서 교재로서 사용하고 있는 디버깅을 통해 배우는 리눅스 커널의
구조와 원리 책에서는 태스크릿 (Tasklet)을 SoftIRQ와 함께 아래와 같이 설명한다.</p>
<p>SoftIRQ 서비스 중 하나로 동적으로 Soft IRQ 서비스를 쓸 수 있는 인터페이스이다.
그리고 이와 함께 Tasklet의 실행 단계에 대한 내용이 자세하게 기술되어 있다.</p>
<p>인터럽트 핸들러에서 task_schedule() 함수를 호출해 태스크릿 스케쥴링을 실행한다.
task_schedule() 함수는 raise_softirq_irqoff() 함수를 호출해 TASKLET Soft IRQ
서비스를 요청한다. Soft IRQ 서비스 핸들러를 호출하는 __do_softirq() 함수에서
태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다. Soft IRQ 서비스
핸들러를 실행한 후 실행 시간을 체크해 ksoftirqd 를 깨우고 실행을 마무리한다.
ksoftirqd 스레드에서 태스크릿 서비스 핸들러인 tasklet_action() 함수를 호출한다.
tasklet_action() 함수에서 태스크릿 핸들러 함수를 호출한다. 책에서는 SoftIRQ를
인터럽트 후반부를 빨리 처리해야 할 때 사용하는 기법으로 설명하고 있고 디바이스
드라이버에서 SoftIRQ를 사용하는 방법으로서 Tasklet 서비스를 설명하고 있다.
그런데 예전 소스 코드 기반이라 그런지 찾아본 내용과 다른 부분이 있다. 최신
코드를 기준으로 찾아보면 tasklet에 대해 아래와 같이 설명한다.</p>
<p>/* Tasklets &mdash; multithreaded analogue of BHs.</p>
<p>This API is deprecated. Please consider using threaded IRQs instead:
<a href="https://lore.kernel.org/lkml/20200716081538.2sivhkj4hcyrusem@linutronix.de">https://lore.kernel.org/lkml/20200716081538.2sivhkj4hcyrusem@linutronix.de</a></p>
<p>Main feature differing them of generic softirqs: tasklet
is running only on one CPU simultaneously.</p>
<p>Main feature differing them of BHs: different tasklets
may be run simultaneously on different CPUs.</p>
<p>Properties:</p>
<ul>
<li>If tasklet_schedule() is called, then tasklet is guaranteed
to be executed on some cpu at least once after this.</li>
<li>If the tasklet is already scheduled, but its execution is still not
started, it will be executed only once.</li>
<li>If this tasklet is already running on another CPU (or schedule is called
from tasklet itself), it is rescheduled for later.</li>
<li>Tasklet is strictly serialized wrt itself, but not
wrt another tasklets. If client needs some intertask synchronization,
he makes it with spinlocks.
*/</li>
</ul>
<p>$linux/include/linux/interrupt.h</p>
<p>코드에서는 태스크릿 대신 Threaded IRQ를 사용할 것을 권한다. 코멘트의 링크를
따라가보면 태스크릿 매크로를 수정한 건에 대한 패치에서 태스크릿을 별도의
작업(refactor all tasklet users into other APIs · Issue #94 · KSPP/linux)으로
제거하자는 얘기가 나온다. 논의 내용을 잘 정리한 LWN 기사(Modernizing the tasklet
API [LWN.net]) 도 찾을 수 있었는데 간단하게 정리해보면 아래와 같다.</p>
<p>Threaded IRQ 도 atomic context에서 실행되므로 tasklet을 대체될 수 있다. 코어
개발자들도 태스크릿의 API를 개선하는 것보다 제거하는 게 더 큰 작업이지만 next
step 으로 제거하는 데에는 동의하였다. LWN 에서 이전에 다룬 내용이지만 태스크릿은
software interrupt mode에서 실행되기 때문에 다른 highest-priority 태스크들을
블록할 수 있는 latency 제한 문제가 있다. Tasklet은 workqueues, timers, threaded
interrupts로 대체 가능하다. Threaded irq를 사용하면 인터럽트 핸들러 자체에서
실행될 수 있다. 그리고 이러한 신규 매커니즘들은 태스크릿의 단점들이 없기 때문에
굳이(?) 개발자들이 tasklet 을 쓸 이유가 없다. 결론적으로 태스크릿을 꼭
써야한다면 어쩔 수 없겠지만 이후에 새로 나온 방법들로도 충분히 BH 를 다룰 수
있으며 이러한 방법을 제외하고 굳이 써야하는 이유는 없다는 것이다. 태스크릿을
반드시 써야 하는 경우를 판단해야 한다면 아래 링크들과 교재 내용을 함께
참고해보자.</p>
<h2 id="참고" class="scroll-mt-8 group">
  참고
  
    <a href="#%ec%b0%b8%ea%b3%a0"
        class="no-underline hidden opacity-50 hover:opacity-100 !text-inherit group-hover:inline-block"
        aria-hidden="true" title="Link to this heading" tabindex="-1">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  width="16"
  height="16"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-link w-4 h-4 block"
  viewBox="0 0 24 24"
>
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
</svg>

    </a>
  
</h2>
<ul>
<li>Modernizing the tasklet API [LWN.net]</li>
<li>Re: [PATCH 0/3] Modernize tasklet callback API - Allen (kernel.org)</li>
</ul>

  </article>
    <aside class="not-prose flex flex-col space-y-8 border-t pt-6">
    <section class="flex flex-col space-y-4">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-shapes h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path
    d="M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z"
  />
  <rect width="7" height="7" x="3" y="14" rx="1" />
  <circle cx="17.5" cy="17.5" r="3.5" />
</svg>

        <span>Categories</span>
      </h2>

      <ul class="ml-6 flex flex-row flex-wrap items-center space-x-2">
          <li>
            <a href="/categories/kernel/" class="taxonomy category">Kernel</a>
          </li>
      </ul>
    </section>
    <section class="flex flex-col space-y-4">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-tags h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19" />
  <path
    d="M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z"
  />
  <circle cx="6.5" cy="9.5" r=".5" fill="currentColor" />
</svg>

        <span>Tags</span>
      </h2>

      <ul class="not-prose ml-6 flex flex-row flex-wrap items-center space-x-2">
          <li>
            <a href="/tags/tasklet/" class="taxonomy tag">tasklet</a>
          </li>
      </ul>
    </section>
    <section class="flex flex-col space-y-4" aria-hidden="true">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-chart-network h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path
    d="m13.11 7.664 1.78 2.672M14.162 12.788l-3.324 1.424M20 4l-6.06 1.515M3 3v16a2 2 0 0 0 2 2h16"
  />
  <circle cx="12" cy="6" r="2" />
  <circle cx="16" cy="12" r="2" />
  <circle cx="9" cy="15" r="2" />
</svg>

        <span>Graph</span>
      </h2>

      <content-network-graph
  class="h-64 ml-6"
  data-endpoint="/graph/index.json"
  page="/posts/tasklet2/"
></content-network-graph>

    </section>
    <section class="flex flex-col space-y-4">
      <h2 class="flex flex-row items-center space-x-2 text-lg font-semibold">
        <svg
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
  stroke="currentColor"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  class="lucide lucide-newspaper h-4 w-4"
  viewBox="0 0 24 24"
  aria-hidden="true"
>
  <path
    d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2M18 14h-8M15 18h-5"
  />
  <path d="M10 6h8v4h-8V6Z" />
</svg>

        <span>Posts</span>
      </h2>
        <section class="flex flex-col space-y-1">
          <h3 class="flex flex-row items-center space-x-2 text-sm font-semibold">
            <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 256 256"
  class="h-4 w-4"
  aria-hidden="true"
>
  <path
    fill="currentColor"
    d="M222.16 153.26a8 8 0 0 1-1 11.25c-17.36 14.38-32.86 19.49-47 19.49-18.58 0-34.82-8.81-49.93-17-25.35-13.75-47.24-25.63-79.07.74a8 8 0 1 1-10.22-12.3c40.17-33.27 70.32-16.92 96.93-2.48 25.35 13.75 47.24 25.62 79.07-.75a8 8 0 0 1 11.22 1.05m-177-49.46c31.83-26.37 53.72-14.5 79.07-.75 15.11 8.2 31.35 17 49.93 17 14.14 0 29.64-5.11 47-19.49a8 8 0 1 0-10.22-12.3c-31.83 26.37-53.72 14.49-79.07.74-26.61-14.43-56.76-30.79-96.93 2.48a8 8 0 0 0 10.17 12.32Z"
  />
</svg>

            <span>Related</span>
          </h3>

          <ol class="not-prose ml-6">
    <li>
      <article class="flex flex-row items-center">
        <header class="grow">
          <h3>
            <a
              href="/posts/tasklet/"
              class="truncate text-sm underline decoration-slate-300 decoration-2 underline-offset-4 hover:decoration-inherit"
              title="태스크릿(Tasklet)"
              >태스크릿(Tasklet)</a
            >
          </h3>
        </header>
          <ul class="flex flex-row items-center justify-end space-x-2">
              <li>
                <a
                  href="/categories/kernel/"
                  class="taxonomy"
                  title="Posts and notes on Kernel"
                  >Kernel</a
                >
              </li>
          </ul>
      </article>
    </li>
    <li>
      <article class="flex flex-row items-center">
        <header class="grow">
          <h3>
            <a
              href="/posts/obsidian/"
              class="truncate text-sm underline decoration-slate-300 decoration-2 underline-offset-4 hover:decoration-inherit"
              title="Obsidian"
              >Obsidian</a
            >
          </h3>
        </header>
          <ul class="flex flex-row items-center justify-end space-x-2">
              <li>
                <a
                  href="/categories/etc/"
                  class="taxonomy"
                  title="Posts and notes on Etc"
                  >Etc</a
                >
              </li>
          </ul>
      </article>
    </li>
    <li>
      <article class="flex flex-row items-center">
        <header class="grow">
          <h3>
            <a
              href="/posts/setting-mu4e/"
              class="truncate text-sm underline decoration-slate-300 decoration-2 underline-offset-4 hover:decoration-inherit"
              title="mu4e 설정하기"
              >Mu4e 설정하기</a
            >
          </h3>
        </header>
          <ul class="flex flex-row items-center justify-end space-x-2">
              <li>
                <a
                  href="/categories/etc/"
                  class="taxonomy"
                  title="Posts and notes on Etc"
                  >Etc</a
                >
              </li>
          </ul>
      </article>
    </li>
    <li>
      <article class="flex flex-row items-center">
        <header class="grow">
          <h3>
            <a
              href="/posts/bsd_queue/"
              class="truncate text-sm underline decoration-slate-300 decoration-2 underline-offset-4 hover:decoration-inherit"
              title="BSD 버전 Linked List"
              >BSD 버전 Linked List</a
            >
          </h3>
        </header>
          <ul class="flex flex-row items-center justify-end space-x-2">
              <li>
                <a
                  href="/categories/c/"
                  class="taxonomy"
                  title="Posts and notes on C"
                  >C</a
                >
              </li>
          </ul>
      </article>
    </li>
    <li>
      <article class="flex flex-row items-center">
        <header class="grow">
          <h3>
            <a
              href="/posts/micom-vs-mpu/"
              class="truncate text-sm underline decoration-slate-300 decoration-2 underline-offset-4 hover:decoration-inherit"
              title="MICOM과 MPU"
              >MICOM과 MPU</a
            >
          </h3>
        </header>
          <ul class="flex flex-row items-center justify-end space-x-2">
              <li>
                <a
                  href="/categories/kernel/"
                  class="taxonomy"
                  title="Posts and notes on Kernel"
                  >Kernel</a
                >
              </li>
          </ul>
      </article>
    </li>
</ol>

        </section>
    </section>
</aside>


      </main>
      <footer class="mt-20 border-t border-neutral-100 pt-2 text-xs">
        <section class="items-top flex flex-row justify-between opacity-70">
  <div class="flex flex-col space-y-2">
      <p>Copyright &copy; 2024, Sukbeom Kim.</p>

  </div>
    <div>
      <a
        href="https://github.com/michenriksen/hugo-theme-til"
        title="Today I Learned &#8212; A Hugo theme by Michael Henriksen"
        data-theme-version="0.6.0"
        >theme: til</a
      >
    </div>
</section>

      </footer>
    </div>
    
  </body>
</html>
