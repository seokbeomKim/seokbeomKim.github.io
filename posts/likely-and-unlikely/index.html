<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Likely and Unlikely | Sukbeom Kim</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="ê°œìš” ğŸ”—ì˜ˆì „ì— ê´€ë¦¬í•˜ë˜ ë¸”ë¡œê·¸ì—ì„œ ì»¤ë„ì—ì„œ ì‚¬ìš©í•˜ëŠ” likelyì™€ unlikely ì— ëŒ€í•´ì„œ ì •ë¦¬í•œ í¬ìŠ¤íŒ…ì´ ìˆì—ˆë‹¤. í•˜ì§€ë§Œ ì‹œê°„ì´ ì§€ë‚˜ ì»¤ë„ ë¶„ì„ ì±…ì„ ë‹¤ì‹œ ë³´ë©° likely, unlik">
<meta name="generator" content="Hugo 0.121.2">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">


  
    
    <link rel="stylesheet" href="https://seokbeomkim.github.iocss/img.css">
  

  
    
    <link rel="stylesheet" href="https://seokbeomkim.github.iocss/noto_sans_kr.css">
  

  
    
    <link rel="stylesheet" href="https://seokbeomkim.github.iocss/nanumgothic.css">
  


<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

 
    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-Y7VW74D2P3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
	  <a class="button" href="https://seokbeomkim.github.io/index.xml">Subscribe</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Likely and Unlikely</h1>

    <div class="tip">
        <time datetime="2020-02-13 23:27:51 &#43;0900 KST">Feb 13, 2020</time>
        <span class="split">
          Â·
        </span>
        <span>
          1149 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          3 minute read
        </span>
    </div>

    
    
        
  


    


    <div class="content">
      <h1 id="ê°œìš”">ê°œìš” <a href="#%ea%b0%9c%ec%9a%94" class="anchor">ğŸ”—</a></h1><p>ì˜ˆì „ì— ê´€ë¦¬í•˜ë˜ ë¸”ë¡œê·¸ì—ì„œ ì»¤ë„ì—ì„œ ì‚¬ìš©í•˜ëŠ” <code>likely</code>ì™€ <code>unlikely</code> ì—
ëŒ€í•´ì„œ ì •ë¦¬í•œ í¬ìŠ¤íŒ…ì´ ìˆì—ˆë‹¤. í•˜ì§€ë§Œ ì‹œê°„ì´ ì§€ë‚˜ ì»¤ë„ ë¶„ì„ ì±…ì„ ë‹¤ì‹œ
ë³´ë©° likely, unlikelyë¥¼ ë³´ë‹ˆ ë‹¤ì‹œ í—·ê°ˆë¦¬ê¸° ì‹œì‘í–ˆë‹¤.</p>
<p>íšŒì‚¬ ì—…ë¬´ì—ì„œ ì‹¤í–‰ ì‹œê°„ì„ ì¤„ì´ëŠ” ë°ì— ì¤‘ìš”ë„ë¥¼ ë‘ê³  ìˆì§€ë§Œ ê·¸ ë°©ë²•ì—
ëŒ€í•´ì„œëŠ” ì•„ì§ ë‹¤ë£¨ì§€ ëª»í•˜ê³  ìˆë‹¤. ì†”ë£¨ì…˜ì´ ì•ˆì •í™”ë˜ê³  ì „ì²´ì ì¸ ì—…ë¬´
ë‚´ìš©ì´ íŒŒì•…ë˜ë©´ ë³¸ ë‚´ìš©ì„ ì •ë¦¬í•˜ë©´ì„œ ì‹¤í–‰ ì‹œê°„ì„ ê°ì†Œí•  ë°©ë²•ìœ¼ë¡œ
predictionì„ ì´ìš©í•˜ëŠ” ê²ƒì„ ê±´ì˜í•´ë³´ê³  ì§„í–‰í•´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.</p>
<h1 id="likely-unlikely">likely(), unlikely() <a href="#likely-unlikely" class="anchor">ğŸ”—</a></h1><p>í•¨ìˆ˜ì˜ ì´ë¦„ ê·¸ëŒ€ë¡œ, ìì£¼ ì¼ì–´ë‚  ë“¯í•˜ê±°ë‚˜ ìì£¼ ì¼ì–´ë‚˜ì§€ ì•Šì„ ë“¯í•œ ê²ƒì„
ìœ„í•œ ë§¤í¬ë¡œì´ë‹¤. ì¶œì²˜ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ì˜ˆì œë¥¼ ì œê³µí•˜ê³  ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>bvl <span style="color:#666">=</span> bvec_alloc(gfp_mask, nr_iovecs, <span style="color:#666">&amp;</span>idx);
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">if</span> (unlikely(<span style="color:#666">!</span>bvl)) {
</span></span><span style="display:flex;"><span>	mempool_free(bio, bio_pool);
</span></span><span style="display:flex;"><span>	bio <span style="color:#666">=</span> <span style="color:#a2f">NULL</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">goto</span> out;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>íŠ¹ì • conditionì„ í™•ì¸í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•˜ëŠ”ë° ìœ„ì˜ ì½”ë“œì—ì„œëŠ”
<code>bvec_alloc</code>ìœ¼ë¡œ í• ë‹¹ë°›ê³  bvlì´ ìœ íš¨í•œ ì£¼ì†Œê°’ì´ë¼ë©´ ë©”ëª¨ë¦¬ í•´ì œë¥¼ í•˜ê³ 
NULLë¡œ ë³€ê²½í•˜ëŠ” ì½”ë“œì´ë‹¤.</p>
<p><code>include/linux/compiler.h</code> íŒŒì¼ì— ì •ì˜ë˜ì–´ ìˆëŠ” ë§¤í¬ë¡œë¡œì„œ branch
prediction ì„ ìœ„í•œ ìš©ë„ë¡œ ì‚¬ìš©ëœë‹¤. ì¦‰, ê²°ê³¼ê°’ì´ ëŒ€ë¶€ë¶„ falseë¡œ
ì˜ˆìƒëœë‹¤ë©´ <code>unlikely()</code>ë¥¼, trueë¡œ ì˜ˆìƒëœë‹¤ë©´ <code>likely()</code>ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì„œ
ì»´íŒŒì¼ëŸ¬ë¥¼ í†µí•œ ë¶„ê¸° ì˜ˆì¸¡ì„ ì´ìš©í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒì„ ê¾€í•  ìˆ˜ ìˆë‹¤.</p>
<p>ê°ê°ì˜ ì •ì˜ë¥¼ ì‚´í´ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ ë˜ì–´ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#080">#define likely(x)       __builtin_expect(!!(x), 1)
</span></span></span><span style="display:flex;"><span><span style="color:#080">#define unlikely(x)     __builtin_expect(!!(x), 0)
</span></span></span></code></pre></div><h1 id="__built-in-function">__built-in function <a href="#__built-in-function" class="anchor">ğŸ”—</a></h1><p><code>__builtin_expect</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì»´íŒŒì¼ëŸ¬ì—ê²Œ ë¶„ê¸° ì˜ˆì¸¡(branch
prediction) ì •ë³´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ê°œë°œìë“¤ì€ ìì‹ ì˜
í”„ë¡œê·¸ë¨ì´ ì–´ë–»ê²Œ ìˆ˜í–‰ë˜ëŠ”ì§€ ì•Œê¸° í˜ë“¤ê¸° ë•Œë¬¸ì— &lsquo;-fprofile-arcs&rsquo;
ì˜µì…˜ì„ í†µí•´ í”„ë¡œíŒŒì¼ì„ í”¼ë“œë°± ë°›ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤. í•˜ì§€ë§Œ
ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë”°ë¼ì„œ ì´ëŸ¬í•œ ì˜µì…˜ì„ í†µí•´ í”„ë¡œíŒŒì¼ë§ì´ í˜ë“  ê²½ìš°ë„
ìˆë‹¤.</p>
<h1 id="ì˜ˆì œ">ì˜ˆì œ <a href="#%ec%98%88%ec%a0%9c" class="anchor">ğŸ”—</a></h1><p>ì•„ë˜ì˜ ì˜ˆì œë¥¼ í†µí•´ ì„±ëŠ¥ í–¥ìƒì´ ì–´ë–»ê²Œ ê°€ëŠ¥í•œì§€ ì‚´í´ë³´ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#080">#define likely(x)    __builtin_expect(!!(x), 1)
</span></span></span><span style="display:flex;"><span><span style="color:#080">#define unlikely(x)  __builtin_expect(!!(x), 0)
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span>
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> <span style="color:#00a000">main</span>(<span style="color:#0b0;font-weight:bold">int</span> argc, <span style="color:#0b0;font-weight:bold">char</span> <span style="color:#666">*</span>argv[]) {
</span></span><span style="display:flex;"><span>	<span style="color:#0b0;font-weight:bold">int</span> a;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	a <span style="color:#666">=</span> atoi (argv[<span style="color:#666">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">if</span> (unlikely (a <span style="color:#666">==</span> <span style="color:#666">2</span>))
</span></span><span style="display:flex;"><span>		a<span style="color:#666">++</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>		a<span style="color:#666">--</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	printf(<span style="color:#b44">&#34;%d</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#b44">&#34;</span>, a);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a2f;font-weight:bold">return</span> <span style="color:#666">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ìœ„ ì˜ˆì œë¥¼ ì»´íŒŒì¼ í•œ ë‹¤ìŒ, objdumpë¡œ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ main ë¶€ë¶„ì„
ë°œê²¬í•  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc -o unlikely unlikely.c
</span></span><span style="display:flex;"><span>$ objdump -S unlikely
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">0000000000001149</span> &lt;main&gt;:
</span></span><span style="display:flex;"><span>    1149:	<span style="color:#666">55</span>                   	push   %rbp
</span></span><span style="display:flex;"><span>    114a:	<span style="color:#666">48</span> <span style="color:#666">89</span> e5             	mov    %rsp,%rbp
</span></span><span style="display:flex;"><span>    114d:	<span style="color:#666">48</span> <span style="color:#666">83</span> ec <span style="color:#666">20</span>          	sub    <span style="color:#b8860b">$0</span>x20,%rsp
</span></span><span style="display:flex;"><span>    1151:	<span style="color:#666">89</span> 7d ec             	mov    %edi,-0x14<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>    1154:	<span style="color:#666">48</span> <span style="color:#666">89</span> <span style="color:#666">75</span> e0          	mov    %rsi,-0x20<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>    1158:	<span style="color:#666">48</span> 8b <span style="color:#666">45</span> e0          	mov    -0x20<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>,%rax
</span></span><span style="display:flex;"><span>    115c:	<span style="color:#666">48</span> <span style="color:#666">83</span> c0 <span style="color:#666">08</span>          	add    <span style="color:#b8860b">$0</span>x8,%rax
</span></span><span style="display:flex;"><span>    1160:	<span style="color:#666">48</span> 8b <span style="color:#666">00</span>             	mov    <span style="color:#666">(</span>%rax<span style="color:#666">)</span>,%rax
</span></span><span style="display:flex;"><span>    1163:	<span style="color:#666">48</span> <span style="color:#666">89</span> c7             	mov    %rax,%rdi
</span></span><span style="display:flex;"><span>    1166:	b8 <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span>       	mov    <span style="color:#b8860b">$0</span>x0,%eax
</span></span><span style="display:flex;"><span>    116b:	e8 d0 fe ff ff       	callq  <span style="color:#666">1040</span> &lt;atoi@plt&gt;
</span></span><span style="display:flex;"><span>    1170:	<span style="color:#666">89</span> <span style="color:#666">45</span> <span style="color:#a2f">fc</span>             	mov    %eax,-0x4<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>    1173:	<span style="color:#666">83</span> 7d <span style="color:#a2f">fc</span> <span style="color:#666">02</span>          	cmpl   <span style="color:#b8860b">$0</span>x2,-0x4<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>    1177:	0f <span style="color:#666">94</span> c0             	sete   %al
</span></span><span style="display:flex;"><span>    117a:	0f b6 c0             	movzbl %al,%eax
</span></span><span style="display:flex;"><span>    117d:	<span style="color:#666">48</span> <span style="color:#666">85</span> c0             	<span style="color:#a2f">test</span>   %rax,%rax
</span></span><span style="display:flex;"><span>    1180:	<span style="color:#666">74</span> <span style="color:#666">06</span>                	je     <span style="color:#666">1188</span> &lt;main+0x3f&gt;
</span></span><span style="display:flex;"><span>    1182:	<span style="color:#666">83</span> <span style="color:#666">45</span> <span style="color:#a2f">fc</span> <span style="color:#666">01</span>          	addl   <span style="color:#b8860b">$0</span>x1,-0x4<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>    1186:	eb <span style="color:#666">04</span>                	jmp    118c &lt;main+0x43&gt;
</span></span><span style="display:flex;"><span>    1188:	<span style="color:#666">83</span> 6d <span style="color:#a2f">fc</span> <span style="color:#666">01</span>          	subl   <span style="color:#b8860b">$0</span>x1,-0x4<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>    118c:	8b <span style="color:#666">45</span> <span style="color:#a2f">fc</span>             	mov    -0x4<span style="color:#666">(</span>%rbp<span style="color:#666">)</span>,%eax
</span></span><span style="display:flex;"><span>    118f:	<span style="color:#666">89</span> c6                	mov    %eax,%esi
</span></span><span style="display:flex;"><span>    1191:	<span style="color:#666">48</span> 8d 3d 6c 0e <span style="color:#666">00</span> <span style="color:#666">00</span> 	lea    0xe6c<span style="color:#666">(</span>%rip<span style="color:#666">)</span>,%rdi        <span style="color:#080;font-style:italic"># 2004 &lt;_IO_stdin_used+0x4&gt;</span>
</span></span><span style="display:flex;"><span>    1198:	b8 <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span>       	mov    <span style="color:#b8860b">$0</span>x0,%eax
</span></span><span style="display:flex;"><span>    119d:	e8 8e fe ff ff       	callq  <span style="color:#666">1030</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span>    11a2:	b8 <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span>       	mov    <span style="color:#b8860b">$0</span>x0,%eax
</span></span><span style="display:flex;"><span>    11a7:	c9                   	leaveq
</span></span><span style="display:flex;"><span>    11a8:	c3                   	retq
</span></span><span style="display:flex;"><span>    11a9:	0f 1f <span style="color:#666">80</span> <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span> <span style="color:#666">00</span> 	nopl   0x0<span style="color:#666">(</span>%rax<span style="color:#666">)</span>
</span></span></code></pre></div><p><code>cmpl %0x2, -0x4(%rbp)</code> ì—ì„œ ë³´ë“¯ 2ì™€ ê°™ì„ ê²½ìš°ì— jump ëª…ë ¹ì–´ë¥¼
ìˆ˜í–‰í•˜ê³  ê°™ì§€ ì•Šì„ ê²½ìš°ì—ëŠ” ê³„ì†í•´ì„œ ëª…ë ¹ì–´ë¥¼ ìˆœì°¨ ì§„í–‰í•œë‹¤. je
ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šìœ¼ë‹ˆ pipeline flushê°€ ì¼ì–´ë‚˜ì§€ ì•Šì•„ branch
predictionì„ í•˜ì§€ ì•Šì•˜ì„ ë•Œë³´ë‹¤ ì„±ëŠ¥ í–¥ìƒì„ ê¾€í•  ìˆ˜ ìˆë‹¤.</p>
<p>ë§Œì•½, <code>likely()</code>ë¥¼ í•˜ê²Œ ë˜ë©´ ì–´ë–¨ê¹Œ? ì•„ë§ˆ ë°˜ëŒ€ë¡œ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë 
ê²ƒì´ë‹¤. ì¦‰, í”„ë¡œê·¸ë˜ë¨¸ê°€ ì˜ˆìƒí•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë¶„ê¸° ì˜ˆì¸¡ì„ í•˜ì—¬ ìµœëŒ€í•œ
jump ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê¸°ë²•ì´ë‹¤.</p>
<h1 id="ì¶œì²˜">ì¶œì²˜ <a href="#%ec%b6%9c%ec%b2%98" class="anchor">ğŸ”—</a></h1><ul>
<li><a href="https://woodz.tistory.com/67" target="_blank" rel="noopener">https://woodz.tistory.com/67</a></li>
</ul>

    </div>

    
        <div class="tags">
            
                <a href="https://seokbeomkim.github.io/tags/likely">likely</a>
            
                <a href="https://seokbeomkim.github.io/tags/unlikely">unlikely</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <div class="copyright">
    
        Copyright - Sukbeom Kim
    
    </div>

    
</footer>



  </body>
</html>
